webpackJsonp([17],{SOCa:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={name:"ActivityTicketingManagement",components:{BreadCrumb:i("ZPfm").a},data:function(){return{active_id:null,business_name:null,active_name:null,identityVisible:!1,deleteVisible:!1,remarkVisible:!1,useticketVisible:!1,ticketTimeRecordVisible:!1,remark:"",warmImg:i("GvV1"),breadData:[{id:1,name:"活动",urls:"/index",icon:"icon-home"},{id:2,name:"票务管理",urls:"/index/ticket-management",icon:"icon-home"}],cityOptions:[],typeValue:null,plateValue:null,levelValue:null,statusValue:null,dialogImageUrl:"",dialogVisible:!1,tableData:[],historyData:[],ticketData:{sale_num:null,use_num:null,refund_num:null},userInfo:{company_name:null,telphone:null,username:null,contacts:null},ticketTimeRecord:[]}},mounted:function(){this.getTicketList(),this.getCityList()},methods:{handleTicketTimeRecord:function(t){this.ticketTimeRecord=[],console.log(t),this.ticketTimeRecord.push({name:t.contacts,use_num:t.use_num}),console.log(this.ticketTimeRecord),this.ticketTimeRecordVisible=!0},handleBusinessAuthen:function(t){this.userInfo="",this.userInfo=t,this.identityVisible=!0},handleSeeSignUp:function(t){this.$router.push({path:"/index/activity/activity-seeSignUp",query:{id:t}})},handleTicketSituation:function(t){this.ticketData={},this.ticketData=t,this.useticketVisible=!0},handleSubmit:function(){var t=this;this.HttpClient.post("/admin/remarkLog/create",{content:this.remark,source_id:this.active_id}).then(function(e){200===e.data.code?(t.remark="",setTimeout(function(){t.getRemarkList(t.active_id)},350),t.$message.success(e.data.msg)):t.$message.error(e.data.msg)})},handleAddRemark:function(t){this.active_id=t,this.getRemarkList(t),this.remarkVisible=!0},getRemarkList:function(t){var e=this;this.HttpClient.post("/admin/remarkLog/lists",{source_id:t}).then(function(t){console.log(t),e.historyData=t.data.data.reverse()})},getCityList:function(){var t=this;this.HttpClient.post("/admin/activesOrders/lists",{order_start:"asc"}).then(function(e){if(console.log(e),200===e.data.code){for(var i=0;i<e.data.data.data.length;i++)t.cityOptions.push({value:e.data.data.data[i].city,label:e.data.data.data[i].city_name});t.uniqueArray(t.cityOptions,"label")}})},getTicketList:function(t,e,i){var a=this;this.HttpClient.post("/admin/activesOrders/lists",{order_start:"asc",city:t,title:e,company_name:i}).then(function(t){console.log(t),200===t.data.code&&(a.tableData=[],a.tableData=t.data.data.data)})},uniqueArray:function(t,e){for(var i=[t[0]],a=1;a<t.length;a++){for(var s=t[a],n=!1,l=0;l<i.length;l++)if(s[e]==i[l][e]){n=!0;break}n||i.push(s)}this.cityOptions=i},handleBusinessNameChange:function(t){console.log(this.business_name),this.getTicketList(this.typeValue,this.active_name,this.business_name)},handleActiveNameChange:function(t){console.log(this.active_name),this.getTicketList(this.typeValue,this.active_name,this.business_name)},handleCityChange:function(){console.log(this.typeValue),this.getTicketList(this.typeValue,this.active_name,this.business_name)},handleTypeChange:function(){console.log(this.plateValue)},handleRemove:function(t,e){console.log(t,e)},handlePreview:function(t){console.log(t)},handleExceed:function(t,e){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+t.length+" 个文件，共选择了 "+(t.length+e.length)+" 个文件")},beforeRemove:function(t,e){return this.$confirm("确定移除 "+t.name+"？")},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleExamine:function(){this.examineVisible=!1},handleDelete:function(){this.deleteVisible=!1}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"activityTicketingManagement"},[i("BreadCrumb",{staticClass:"bread",attrs:{breadData:t.breadData}}),t._v(" "),i("div",{staticClass:"content"},[i("p",{staticClass:"title"},[t._v("票务管理")]),t._v(" "),i("div",{staticClass:"content_contain"},[i("div",{staticClass:"conditions"},[i("el-select",{staticClass:"select_normal",attrs:{placeholder:"城市性质"},on:{change:t.handleCityChange},model:{value:t.typeValue,callback:function(e){t.typeValue=e},expression:"typeValue"}},[i("el-option",{attrs:{label:"全部",value:null}}),t._v(" "),t._l(t.cityOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2),t._v(" "),i("div",{staticClass:"select_normal"},[i("el-input",{attrs:{placeholder:"活动名称",clearable:""},on:{change:t.handleActiveNameChange},model:{value:t.active_name,callback:function(e){t.active_name=e},expression:"active_name"}}),t._v(" "),i("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleActiveNameChange}})],1),t._v(" "),i("div",{staticClass:"select_normal"},[i("el-input",{attrs:{placeholder:"商家对外名称",clearable:""},on:{change:t.handleBusinessNameChange},model:{value:t.business_name,callback:function(e){t.business_name=e},expression:"business_name"}}),t._v(" "),i("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.handleBusinessNameChange}})],1)],1),t._v(" "),i("div",{staticClass:"tables"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"",stripe:!0,"header-row-style":{height:"40px"},"header-cell-style":{padding:0,background:"#15bafe",color:"white"},"row-style":{height:"40px"},"cell-style":{padding:0}}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"70","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{label:"活动名称",width:"240","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"row_activity"},[t._v(t._s(e.row.title))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"city_name",label:"城市",width:"100","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"company_name",label:"商家对外名称",width:"180","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"price_receive",label:"收到金额",width:"120","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{label:"已转商户",prop:"transfer",width:"180","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{label:"未使用金额",width:"120","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.price*(e.row.sale_num-e.row.use_num-e.row.refund_num)))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"price_refund",label:"退款金额",width:"120","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{prop:"active_date_start",label:"活动开始时间",width:"160","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(i){t.handleSeeSignUp(e.row.active_id)}}},[t._v("查看报名")]),t._v(" "),i("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(i){t.handleAddRemark(e.row.active_id)}}},[t._v("添加备注")]),t._v(" "),i("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(i){t.handleBusinessAuthen(e.row)}}},[t._v("商家身份确认")]),t._v(" "),i("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(i){t.handleTicketSituation(e.row)}}},[t._v("用票情况")]),t._v(" "),i("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(i){t.handleTicketTimeRecord(e.row)}}},[t._v("验票时间记录")])]}}])})],1)],1)])]),t._v(" "),i("el-dialog",{staticClass:"frame",attrs:{visible:t.remarkVisible,width:"400px"},on:{"update:visible":function(e){t.remarkVisible=e}}},[i("div",{staticClass:"dialog_delete_head_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-edit-square delete_icon"}),t._v(" "),i("span",[t._v("添加备注")])]),t._v(" "),i("div",{staticClass:"remark_content"},[i("p",{staticClass:"remark_p"},[t._v("内容")]),t._v(" "),i("el-input",{staticClass:"text_area",attrs:{type:"textarea",rows:2,placeholder:"商家的修改，取消，结束活动都将显示在历史里面"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}}),t._v(" "),i("p",{staticClass:"history_p"},[t._v("历史")]),t._v(" "),i("div",{staticClass:"h_content"},t._l(t.historyData,function(e,a){return i("div",{key:a,staticClass:"history_item"},[i("div",{staticClass:"item_top"},[i("div",{staticClass:"point"}),t._v(" "),i("p",{staticClass:"h_name"},[t._v(t._s(e.create_name))]),t._v(" "),i("p",{staticClass:"h_time"},[t._v(t._s(e.created_at))])]),t._v(" "),i("p",{staticClass:"h_message"},[t._v(t._s(e.content))])])}))],1),t._v(" "),i("div",{staticClass:"user_footer",attrs:{slot:"footer"},slot:"footer"},[i("el-row",{staticClass:"row_e"},[i("el-button",{staticClass:"btn_deletes",attrs:{size:"small"},on:{click:function(e){t.remarkVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{staticClass:"btn_delete",attrs:{type:"primary",size:"small"},on:{click:t.handleSubmit}},[t._v("提交")])],1)],1)]),t._v(" "),i("el-dialog",{attrs:{visible:t.identityVisible,width:"350px"},on:{"update:visible":function(e){t.identityVisible=e}}},[i("div",{staticClass:"dialog_delete_head_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-edit-square delete_icon"}),t._v(" "),i("span",[t._v("商家身份确认")])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("商家电话：")]),t._v(" "),i("div",[t._v(t._s(t.userInfo.telphone))])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("商家账号：")]),t._v(" "),i("div",[t._v(t._s(t.userInfo.username))])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("姓名：")]),t._v(" "),i("div",[t._v(t._s(t.userInfo.contacts))])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("工商全名：")]),t._v(" "),i("div",[t._v(t._s(t.userInfo.company_name))])])]),t._v(" "),i("el-dialog",{attrs:{visible:t.useticketVisible,width:"350px"},on:{"update:visible":function(e){t.useticketVisible=e}}},[i("div",{staticClass:"dialog_delete_head_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-edit-square delete_icon"}),t._v(" "),i("span",[t._v("用票情况")])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("报名票数：")]),t._v(" "),i("div",[t._v(t._s(t.ticketData.sale_num))])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("使用票数：")]),t._v(" "),i("div",[t._v(t._s(t.ticketData.use_num))])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("退款票数：")]),t._v(" "),i("div",[t._v(t._s(t.ticketData.refund_num))])]),t._v(" "),i("div",{staticClass:"phone"},[i("span",[t._v("未使用票数：")]),t._v(" "),i("div",[t._v(t._s(t.ticketData.sale_num-t.ticketData.refund_num-t.ticketData.use_num))])])]),t._v(" "),i("el-dialog",{attrs:{visible:t.ticketTimeRecordVisible,width:"450px"},on:{"update:visible":function(e){t.ticketTimeRecordVisible=e}}},[i("div",{staticClass:"dialog_delete_head_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-edit-square delete_icon"}),t._v(" "),i("span",[t._v("验票时间记录")])]),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.ticketTimeRecord,border:""}},[i("el-table-column",{attrs:{fixed:"",prop:"name",label:"用户姓名",width:"130"}}),t._v(" "),i("el-table-column",{attrs:{prop:"use_num",label:"使用票数",width:"100"}}),t._v(" "),i("el-table-column",{attrs:{prop:"province",label:"验票时间",width:"179"}})],1)],1)],1)},staticRenderFns:[]};var n=i("VU/8")(a,s,!1,function(t){i("mjMV"),i("a4fG")},"data-v-bb8495dc",null);e.default=n.exports},a4fG:function(t,e){},mjMV:function(t,e){}});