webpackJsonp([5],{"8jRL":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("mvHQ"),s=i.n(n),a=i("ZPfm"),l={name:"Jurisdiction",props:["addMenu"],components:{menuTrees:{name:"tree-menu",template:'\n            <div class="tree-menu">\n              <div class="label-wrapper">\n                <div :style="indent" class="parent_menu" style="display:flex;align-items:center;">\n                <div class="menu_label">\n                  <i @click="toggleChildren(id,label)" v-if="child" class="iconfont icon_left" :class="showChildren?\'icon-jian-xianxingfangkuang\':\'icon-jia-xianxingfangkuang\'"></i>\n                  <span @click="handleSelect(id,label,child)" :style="depth===0?{background:\'#1A67AB\'}:depth===1?{background:\'#1E86E5\'}:depth===2?{background:\'#4DACFE\'}:{background:\'#26C0D5\'}" class="lbl_menu">{{ label }}/{{id}}</span>\n                </div>\n                  <i @click="addCurrentJur" class="iconfont icon-plus-square-fill icon_add" v-if="(child === undefined)?true:false"></i>\n                </div>\n              </div>\n              <tree-menu\n                v-if="showChildren"\n                v-for="item in child"\n                :child="item.child"\n                :label="item.name"\n                :depth="depth + 1"\n                :key="item.id"\n                :id="item.id"\n                @ee="xx"\n                v-on:qq="yy"\n                :addMenu="addMenu"\n                ref="mychild"\n              >\n              </tree-menu>\n            </div>\n          ',props:["child","label","depth","id","addMenu"],data:function(){return{showChildren:!1,menu_visible:!1,menu_id:null,tab_index:null,menu_name:"",existingAuthority:null,select_menuId:null,select_menuName:null}},computed:{indent:function(){return{transform:"translate("+20*this.depth+"px)"}}},methods:{addCurrentJur:function(){var e=this;console.log(this.addMenu),console.log(this.existingAuthority);for(var t=this.addMenu.id,i=[],n=0;n<this.existingAuthority.length;n++)i.push(this.existingAuthority[n].id);console.log(i),-1!=i.indexOf(t)?this.$message.error("当前菜单有此条权限，请勿重复添加"):this.HttpClient.post("/admin/menuPermission/create",{menu_id:this.select_menuId,permission_id:t}).then(function(t){console.log(t),200===t.data.code?(e.$message.success("权限添加成功"),setTimeout(function(){e.handleSelect(e.select_menuId,e.select_menuName)},500)):e.$message.error(t.data.msg)})},handleSelect:function(e,t,i){var n=this;void 0===i&&(console.log(e,t),this.select_menuName=t,this.select_menuId=e,this.HttpClient.post("/admin/menuPermission/getAll",{menu_id:e}).then(function(i){console.log(i),n.menu_name=t,console.log(n.menu_name),n.existingAuthority=i.data.data,n.$store.dispatch("getSelectMenuInfo",{old_jur:n.existingAuthority,menu_name:n.select_menuName,id:e}),n.$emit("qq",n.existingAuthority)}))},toggleChildren:function(e,t){this.showChildren=!this.showChildren,this.menu_visible=!0,this.menu_id=e,this.tab_index=e,this.$emit("ee",{id:this.menu_id,menu_visible:this.menu_visible,menu_name:t}),this.$store.dispatch("getMenuInfo",{id:this.menu_id,menu_visible:this.menu_visible}).then(function(e){})},openMenuModal:function(e){var t=this;this.menu_visible=!0,this.menu_id=e,this.tab_index=e,this.$emit("ee",{id:this.menu_id,menu_visible:this.menu_visible}),this.$store.dispatch("getMenuInfo",{id:this.menu_id,menu_visible:this.menu_visible}).then(function(e){console.log(333,t.$store.state.menu.menu)})},deleteMenu:function(e){console.log(e)},editMenu:function(e){console.log(e)},xx:function(){this.$emit("ee",{id:this.menu_id,menu_visible:this.menu_visible,menu_name:this.menu_name})},yy:function(){this.$emit("qq",this.existingAuthority)}}}},data:function(){return{show:!1,typeTitle:"",index:0,menuVisible:!0,menu_id:null,menu_name:"您还未选取菜单",treeData:{id:0,name:"root",children:[{id:1,name:"菜单1",children:[{id:11,name:"菜单11"},{id:12,name:"菜单12"}]},{id:2,name:"菜单2",children:[{id:21,name:"菜单21"},{id:22,name:"菜单22"}]}]},checkAll:!1,checkedJurisdiction:[],jurisdictionData:null,isIndeterminate:!0,menu_list:[]}},mounted:function(){this.getMenulist(),console.log(this.addMenu)},methods:{handleChange:function(e){var t=this;console.log(e),console.log(this.$store.state.menu.select_menu.id),this.HttpClient.post("/admin/menuPermission/destroy",{menu_id:this.$store.state.menu.select_menu.id,permission_id:e}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),setTimeout(function(){console.log(t.$store.state.menu.select_menu),t.$refs.mychild[0].handleSelect(t.$store.state.menu.select_menu.id,t.$store.state.menu.select_menu.menu_name)},350)):t.$message.error(e.data.msg+"请在该菜单的子菜单中删除该权限！")})},getMenulist:function(){var e=this;this.HttpClient.post("/admin/menu/getList",{}).then(function(t){console.log(t),e.menu_list=t.data.data,console.log(e.menu_list)})},getMenu:function(e){var t=this;setTimeout(function(){var e=t.$store.state.menu.menu;t.menuVisible=e.menu_visible,t.menu_id=e.id,t.menu_name=t.$store.state.menu.menu.menu_name,t.$emit("ee",{id:t.menu_id,menu_visible:t.menu_visible,checkedJurisdiction:t.checkedJurisdiction})})},handleCheckAllChange:function(e){console.log(e),this.checkedJurisdiction=e?this.jurisdictionData:[],console.log(this.checkedJurisdiction),this.isIndeterminate=!1,this.$emit("ee",{id:this.menu_id,menu_visible:this.menu_visible,checkedJurisdiction:this.checkedJurisdiction})},handleCheckedCitiesChange:function(e){console.log(e);var t=e.length;this.checkAll=t===this.jurisdictionData.length,this.isIndeterminate=t>0&&t<this.jurisdictionData.length,this.$emit("ee",{id:this.menu_id,menu_visible:this.menu_visible,checkedJurisdiction:this.checkedJurisdiction})},rr:function(e){console.log(this.$store.state.menu),this.jurisdictionData=this.$store.state.menu.select_menu.old_jur,console.log(this.jurisdictionData),this.checkedJurisdiction=this.jurisdictionData,void 0===this.$store.state.menu.select_menu.id?this.menu_name="您还未选取菜单":this.menu_name=this.$store.state.menu.select_menu.menu_name+"菜单下的权限"}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"menus"},[i("div",{staticClass:"menu_left"},[i("div",{staticClass:"left_content"},[i("p",{staticClass:"left_title"},[e._v("现有菜单")]),e._v(" "),e._l(e.menu_list,function(t,n){return i("div",{key:n},[i("menuTrees",{ref:"mychild",refInFor:!0,staticClass:"menu_trees",attrs:{child:t.child,depth:0,name:t.name,id:t.id,label:t.folder_name,addMenu:e.addMenu},on:{ee:e.getMenu,qq:function(t){e.rr()}}})],1)})],2)]),e._v(" "),i("div",{staticClass:"menu_right"},[i("p",{staticClass:"right_title"},[e._v(e._s(e.menu_name))]),e._v(" "),i("div",{staticClass:"item_contain",style:e.menuVisible?{display:"block"}:{display:"none"}},[i("div",{staticClass:"jurisdiction_content"},[i("el-checkbox",{staticClass:"all_check",attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),i("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),i("el-checkbox-group",{staticClass:"check_group",on:{change:e.handleCheckedCitiesChange},model:{value:e.checkedJurisdiction,callback:function(t){e.checkedJurisdiction=t},expression:"checkedJurisdiction"}},e._l(e.jurisdictionData,function(t){return i("el-checkbox",{key:t.id,staticClass:"check_item",attrs:{label:t},on:{change:function(i){e.handleChange(t.id)}}},[i("span",{staticClass:"check_lab"},[e._v(e._s(t.label)+e._s(t.id)),i("span",{staticClass:"line"}),e._v(e._s(t.name))])])}))],1)])])])},staticRenderFns:[]};var c=i("VU/8")(l,o,!1,function(e){i("YrAX"),i("JF0a")},"data-v-241ab94e",null).exports,u=i("+jNi"),d={name:"InsideJurisdiction",components:{BreadCrumb:a.a,menuTrees:c,DeleteModal:u.a},data:function(){return{amendId:"",amendarrayValue:null,amendRank:null,amenddescription:null,amendrouterName:null,amendjucsName:null,amendVisible:!1,description:null,routerName:null,jucsName:null,slist:[],arrayValue:"",addVisible:!1,menuVisible:!1,menu_id:null,checkedJurisdiction:[],breadData:[{id:1,name:"内部管理",urls:"/index",icon:"icon-home"},{id:2,name:"权限管理",urls:"/index/test",icon:"icon-home"}],arrayOptions:[{value:1,label:"全部"},{value:2,label:"长期"}],list:[],name:"",label:"",currentPage:1,pageSize:25,pageNum:0,deleteId:"",addMenu:null}},mounted:function(){this.getJurisdiction()},methods:{handleClose:function(){this.getJurisdiction(),this.menuVisible=!1},bandleMenuAssignment:function(e){this.addMenu=e,console.log(this.addMenu),this.menuVisible=!0},getJurisdiction:function(){var e=this,t={size:this.pageSize,page:this.currentPage};this.name&&(t.name=this.name),this.label&&(t.label=this.label),console.log(t),this.HttpClient.post("/admin/permission/getList",t).then(function(t){console.log(t);var i=t.data,n=i.code,s=i.data;200===n&&(e.slist=s.data,console.log(s.total),e.pageNum=Math.ceil(s.total/e.pageSize),console.log(e.pageNum))})},amendClick:function(){var e=this;this.HttpClient.post("/admin/permission/edit",{id:this.amendId,name:this.amendrouterName,label:this.amendjucsName,type:this.amendarrayValue,description:this.amenddescription,cid:this.amendRank,icon:null}).then(function(t){console.log(t),200===t.data.code?(e.$message.success(t.data.msg),e.emptyValue(),e.amendVisible=!1,setTimeout(function(){e.getJurisdiction()},800)):e.$message.error(t.data.msg)})},cancelCompile:function(){this.amendVisible=!1,this.addVisible=!1,this.emptyValue()},amendFunction:function(e){this.amendVisible=!0,this.amendjucsName=e.label,this.amendrouterName=e.name,this.amenddescription=e.description,this.amendRank=e.cid,this.amendarrayValue=e.type,this.amendId=e.id},RouterChange:function(){},RouterBlur:function(){},handleDelete:function(e){this.deleteId=e,this.$refs.delete.deleteDialog=!0},deleteJurisdiction:function(e){var t=this;e&&this.HttpClient.post("/admin/permission/destroy",{id:this.deleteId}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),setTimeout(function(){t.getJurisdiction()},800)):t.$message.error(e.data.msg)})},newJurisdiction:function(){var e=this;this.HttpClient.post("/admin/permission/create",{label:this.jucsName,name:this.routerName,type:1,description:this.description,cid:1,icon:null}).then(function(t){console.log(t),200===t.data.code?(e.$message.success(t.data.msg),e.emptyValue(),e.addVisible=!1,setTimeout(function(){e.getJurisdiction()},800)):e.$message.error(t.data.msg)})},getMenuItem:function(e){console.log("data",e),this.menu_id=this.$store.state.menu.menu.id,this.checkedJurisdiction=e},setSlist:function(e){this.slist=JSON.parse(s()(e))},currentChange:function(e){this.currentPage=e,this.getJurisdiction()},emptyValue:function(){this.jucsName="",this.routerName="",this.description="",this.arrayValue=""}}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"insideJurisdiction"},[i("BreadCrumb",{staticClass:"bread",attrs:{breadData:e.breadData}}),e._v(" "),i("div",{staticClass:"content"},[i("p",{staticClass:"title"},[e._v("权限管理")]),e._v(" "),i("div",{staticClass:"conditions"},[i("div",[i("el-input",{staticClass:"select_normal",attrs:{placeholder:"搜索名称",size:"mini",clearable:"","suffix-icon":"el-icon-search"},on:{change:e.RouterBlur,clear:e.getJurisdiction},nativeOn:{keyup:function(t){return"button"in t||13===t.keyCode?e.getJurisdiction(t):null}},model:{value:e.label,callback:function(t){e.label=t},expression:"label"}}),e._v(" "),i("el-input",{staticClass:"select_normal",attrs:{placeholder:"搜索方法",size:"mini",clearable:"","suffix-icon":"el-icon-search"},on:{change:e.RouterChange,clear:e.getJurisdiction},nativeOn:{keyup:function(t){return"button"in t||13===t.keyCode?e.getJurisdiction(t):null}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.addVisible=!0}}},[e._v("新增权限")])],1),e._v(" "),i("div",{staticClass:"tabs"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.slist,border:"",stripe:!0,"header-row-style":{height:"40px"},"header-cell-style":{padding:0,background:"#15bafe",color:"white"},"row-style":{height:"40px"},"cell-style":{padding:0}}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"50","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"label",label:"权限名称",width:"150","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"description",label:"介绍",width:"150","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"模块和方法",width:"210","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"menu_1",label:"一级菜单",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[void 0===t.row.menu_1?i("span",[e._v("无")]):i("span",[e._v(e._s(t.row.menu_1))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"menu_2",label:"二级菜单",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[void 0===t.row.menu_2?i("span",[e._v("无")]):i("span",[e._v(e._s(t.row.menu_2))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"类型",width:"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(0===t.row.type?"未分配":"已分配")+"\n            ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"status",label:"状态",width:"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[void 0===t.row.menu_1&&void 0===t.row.menu_2?i("span",{staticClass:"sortout_color"},[e._v("未分配")]):i("span",{staticClass:"normal_color"},[e._v("已分配")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"180","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"updated_at",label:"修改时间",width:"180","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.amendFunction(t.row)}}},[e._v("修改")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.handleDelete(t.row.id)}}},[e._v("删除")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.bandleMenuAssignment(t.row)}}},[e._v("菜单分配")])]}}])})],1),e._v(" "),e.pageNum?i("el-pagination",{attrs:{layout:"prev, pager, next","page-count":e.pageNum},on:{"current-change":e.currentChange}}):e._e()],1)]),e._v(" "),i("el-dialog",{attrs:{visible:e.addVisible,width:"400px"},on:{"update:visible":function(t){e.addVisible=t},close:e.cancelCompile}},[i("div",{staticClass:"dialog_head_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-edit-square examine_icon"}),e._v(" "),i("span",[e._v("新增权限")])]),e._v(" "),i("div",{staticClass:"jurisdiction_content"},[i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("权限名称:")]),e._v(" "),i("el-input",{staticClass:"el_input",attrs:{size:"mini"},model:{value:e.jucsName,callback:function(t){e.jucsName=t},expression:"jucsName"}})],1),e._v(" "),i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("方法:")]),e._v(" "),i("el-input",{staticClass:"el_input",attrs:{size:"mini"},model:{value:e.routerName,callback:function(t){e.routerName=t},expression:"routerName"}})],1),e._v(" "),i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("介绍:")]),e._v(" "),i("el-input",{staticClass:"el_input_text_area",attrs:{placeholder:"100字以内",type:"textarea",autosize:{minRows:3,maxRows:3}},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),e._v(" "),i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("类型选择:")]),e._v(" "),i("el-select",{staticClass:"select_normal el_input",attrs:{size:"mini",placeholder:"操作权限"},model:{value:e.arrayValue,callback:function(t){e.arrayValue=t},expression:"arrayValue"}},e._l(e.arrayOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)]),e._v(" "),i("div",{staticClass:"user_footer",attrs:{slot:"footer"},slot:"footer"},[i("el-row",{staticClass:"row_e"},[i("el-button",{staticClass:"btn_deletes",attrs:{size:"small"},on:{click:e.cancelCompile}},[e._v("取消")]),e._v(" "),i("el-button",{staticClass:"btn_delete",attrs:{type:"primary",size:"small"},on:{click:e.newJurisdiction}},[e._v("保存")])],1)],1)]),e._v(" "),i("el-dialog",{attrs:{visible:e.amendVisible,width:"400px","show-close":!1},on:{"update:visible":function(t){e.amendVisible=t}}},[i("div",{staticClass:"dialog_head_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-edit-square examine_icon"}),e._v(" "),i("span",[e._v("修改权限")])]),e._v(" "),i("div",{staticClass:"jurisdiction_content"},[i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("权限名称:")]),e._v(" "),i("el-input",{staticClass:"el_input",attrs:{size:"mini"},model:{value:e.amendjucsName,callback:function(t){e.amendjucsName=t},expression:"amendjucsName"}})],1),e._v(" "),i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("方法:")]),e._v(" "),i("el-input",{staticClass:"el_input",attrs:{size:"mini"},model:{value:e.amendrouterName,callback:function(t){e.amendrouterName=t},expression:"amendrouterName"}})],1),e._v(" "),i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("介绍:")]),e._v(" "),i("el-input",{staticClass:"el_input_text_area",attrs:{placeholder:"100字以内",type:"textarea",autosize:{minRows:3,maxRows:3}},model:{value:e.amenddescription,callback:function(t){e.amenddescription=t},expression:"amenddescription"}})],1),e._v(" "),i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("级别:")]),e._v(" "),i("el-input",{staticClass:"el_input",attrs:{size:"mini"},model:{value:e.amendRank,callback:function(t){e.amendRank=t},expression:"amendRank"}})],1),e._v(" "),i("div",{staticClass:"jurisdiction_content_item"},[i("label",{staticClass:"el_lbl"},[e._v("类型选择:")]),e._v(" "),i("el-select",{staticClass:"select_normal el_input",attrs:{size:"mini",placeholder:"操作权限"},model:{value:e.amendarrayValue,callback:function(t){e.amendarrayValue=t},expression:"amendarrayValue"}},e._l(e.arrayOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)]),e._v(" "),i("div",{staticClass:"user_footer",attrs:{slot:"footer"},slot:"footer"},[i("el-row",{staticClass:"row_e"},[i("el-button",{staticClass:"btn_deletes",attrs:{size:"small"},on:{click:e.cancelCompile}},[e._v("取消")]),e._v(" "),i("el-button",{staticClass:"btn_delete",attrs:{type:"primary",size:"small"},on:{click:e.amendClick}},[e._v("保存")])],1)],1)]),e._v(" "),i("el-dialog",{attrs:{visible:e.menuVisible,width:"1000px","show-close":!1},on:{"update:visible":function(t){e.menuVisible=t}}},[i("div",{staticClass:"dialog_head_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-menu examine_icon"}),e._v(" "),i("span",[e._v("菜单分配")])]),e._v(" "),i("div",{staticClass:"menu_content"},[i("menuTrees",{ref:"mychild",attrs:{addMenu:e.addMenu},on:{ee:e.getMenuItem}})],1),e._v(" "),i("div",{staticClass:"user_footer",attrs:{slot:"footer"},slot:"footer"},[i("el-row",{staticClass:"row_e"},[i("el-button",{staticClass:"btn_deletes",attrs:{size:"small"},on:{click:e.handleClose}},[e._v("关 闭")])],1)],1)]),e._v(" "),i("delete-modal",{ref:"delete",on:{doDelete:e.deleteJurisdiction}})],1)},staticRenderFns:[]};var m=i("VU/8")(d,r,!1,function(e){i("y/uQ"),i("Ot0L")},"data-v-7ffa197f",null);t.default=m.exports},JF0a:function(e,t){},Ot0L:function(e,t){},YrAX:function(e,t){},"y/uQ":function(e,t){}});