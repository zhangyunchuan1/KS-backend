webpackJsonp([78],{hJgy:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("gRE1"),o=a.n(i),s=a("//Fk"),n=a.n(s),c=a("ZPfm"),l=a("+jNi"),d=(a("G0J2"),a("yPE/")),r=(a("PJh5"),a("AJTU")),u=a.n(r),p=a("37tQ"),g=a("GH0r");d.register("modules/imageResize",u.a),d.register("modules/imageDrop",p.a);var f=["10px","12px","14px","16px","18px","20px"],m=d.import("attributors/style/size");m.whitelist=f,d.register(m,!0);d.import("formats/font").whitelist=["SimSun","SimHei","Microsoft-YaHei","KaiTi","FangSong","Arial","Times-New-Roman","sans-serif"],d.register("modules/ImageExtend",g.a);var _={name:"EncyclopediaModify",components:{BreadCrumb:c.a,DeleteModal:l.a},data:function(){return{editorOption:this.Tools.getQuillOpotion,breadData:[{id:1,name:"百科",urls:"/index/encyclopedia/encyclopedia",icon:"icon-home"},{id:2,name:"百科数据",urls:"/index/encyclopedia/encyclopediaData",icon:"icon-home"}],catalogueVisible:!1,modifyVisible:!1,encyclopediaInfo:{id:"",title:"",cover:"",description:""},firstCatalogue:[],secondCatalogue:[],tags:[],parts:[{link:"",source_name:"",source_id:""}],firstId:"",secondId:"",secondCatalogueSelect:"",isFirst:!0,catalogueId:"",newCatalogueName:"",newCatalogueContent:"",isTagModify:!0,tagId:"",newName:"",partId:"",partIndex:0,partLink:"",encyclopediaID:"",secondData:[],secondoldValue:"",secondValue:"",contentUpData:{},content:""}},methods:{onEditorBlur:function(){},onEditorFocus:function(){},onEditorChange:function(t,e){console.log(this.content);var a=this.content;function i(t){return t=(t=(t=(t=t.replace(/<\/?[^>]*>/g,"")).replace(/[ | ]*\n/g,"\n")).replace(/\n[\s| | ]*\r/g,"\n")).replace(/ /gi,"")}console.log(i(a).length),t.quill.deleteText(e,1),this.$emit("Quescthon",this.content),console.log(this.content);var o=this.Tools.getEditorImageAndLength(this.content);this.editImageSize=o.imgArray.length,i(a).length<2e3?this.newCatalogueContent=this.content:this.$message.error("字数超过限制")},beforeContentUpload:function(t){var e=t.size/1024/1024<10,a=t.name.split(".")[1];if("jpg,png,jpeg,tiff,tif".indexOf(a)<0)return this.$message.error("图片类型只能为jpg,png,jpeg,tiff,tif"),!1;if(!e)return this.$message.error("上传图片大小不能超过 5MB!"),!1;var i=this,o=new FileReader;return o.readAsDataURL(t),new n.a(function(e,a){o.onload=function(){i.contentUpData.token=i.$getQiNiuToken({saveKey:t.name}),e(!0)}})},handleContentSuccess:function(t,e,a){console.log(t,e,a);var i=this.$refs.myQuillEditor.quill,o=i.getSelection().index;i.insertEmbed(o,"image",this.$imagePath+e.response.key),i.setSelection(o+1)},getEncyclopediaInfo:function(){var t=this;this.HttpClient.post("/admin/encyclopedias/getInfo",{id:this.$route.query.id}).then(function(e){if(console.log(e.data),200===e.data.code){console.log(e.data.data),t.encyclopediaInfo=e.data.data;var a=e.data.data,i=(a.id,a.title,a.cover,a.description,a.menu),s=a.label,n=a.source;t.firstCatalogue=o()(i),console.log(o()(i)),t.tags=s,t.parts=n,console.log(t.parts),t.secondoldValue=e.data.data.category.menu_1_id,t.encyclopediaID=e.data.data.encyclopedia_id,t.getchildTypelist(e.data.data.category.folder_id)}})},getchildTypelist:function(t){var e=this,a={menu_id:t,menu_type:2,type:1};this.HttpClient.post("/admin/menu/getOneChild",a).then(function(t){console.log(t.data),200==t.data.code&&(e.secondData=t.data.data.child)})},secondChangeFn:function(){console.log(this.secondoldValue,this.secondValue,this.encyclopediaID)},handleCoverSuccess:function(){},beforeCoverUpload:function(t){var e=this,a="image/jpeg"===t.type,i=t.size/1024/1024<=5;return console.log(t),console.log(t.size/1024/1024),a||this.$message.error("上传图片只能是 JPG 格式!"),i?this.HttpClient.form("/admin/uploadOneImage",{images:t}).then(function(t){console.log(t),200===t.data.code?(e.$message.success(t.data.msg),e.encyclopediaInfo.cover[0].path=t.data.path.substring(25)):e.$message.error(t.data.msg)}):this.$message.error("上传图片大小不能超过 5MB!"),a&&i},firstClick:function(t,e){this.firstId=t,console.log(this.firstCatalogue),this.secondCatalogue=this.firstCatalogue[e].child,console.log(this.secondCatalogue)},secondClick:function(t){this.secondId=t},catalogueModify:function(t,e,a,i){this.catalogueId=t,this.isFirst=i,this.newCatalogueName=a,this.content=e,this.catalogueVisible=!0},updateCatalogue:function(){var t=this;this.newCatalogueContent=this.content,console.log(this.newCatalogueContent),this.HttpClient.post("/admin/encyclopedias/editMenu",{catalog_id:this.catalogueId,name:this.newCatalogueName,content:this.newCatalogueContent}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),t.isFirst?t.firstCatalogue.map(function(e){e.catalog_id===t.catalogueId&&(e.name=t.newCatalogueName)}):t.secondCatalogue.map(function(e){e.catalog_id===t.catalogueId&&(e.name=t.newCatalogueName)}),t.newCatalogueName="",t.newCatalogueContent="",t.catalogueVisible=!1):t.$message.error(e.data.msg)})},tagClick:function(t){this.tagId=t.tag_id,console.log(t),this.newName=t.name,this.isTagModify=!0,this.modifyVisible=!0},deleteTag:function(t){this.tagId=t,this.$refs.delete.deleteDialog=!0},confirmDelete:function(t){var e=this;t&&this.HttpClient.post("/admin/tags/del",{tag_id:this.tagId,relation_id:this.$route.query.aid}).then(function(t){console.log(t),200===t.data.code?(e.$message.success(t.data.msg),e.tags.map(function(t,a){t.tag_id===e.tagId&&e.tags.splice(a,1)})):e.$message.error(t.data.msg)})},updateTag:function(){var t=this;this.isTagModify?this.HttpClient.post("/admin/tags/edit",{tag_id:this.tagId,name:this.newName,relation_id:this.$route.query.aid}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),t.modifyVisible=!1,t.tags.map(function(e){e.tag_id===t.tagId&&(e.name=t.newName)}),t.newName=""):t.$message.error(e.data.msg)}):this.HttpClient.post("/admin/source/edit",{name:this.newName,source_id:this.partId,relation_id:this.$route.query.aid,link:this.partLink,type:2}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),t.modifyVisible=!1,t.parts.map(function(e){e.source_id===t.partId&&(e.source_name=t.newName)}),t.newName=""):t.$message.error(e.data.msg)})},partClick:function(t){this.partIndex=t},z:function(t,e){this.partId=t.source_id,console.log(t),this.newName=t.source_name,this.partIndex=e,this.partLink=t.link,this.modifyVisible=!0,this.isTagModify=!1},linkModify:function(){var t=this,e=this.parts[this.partIndex],a={name:e.source_name,source_id:e.source_id,relation_id:this.$route.query.aid,link:e.link,type:2};this.HttpClient.post("/admin/source/edit",a).then(function(e){console.log(e),200===e.data.code?t.$message.success(e.data.msg):t.$message.error(e.data.msg)})},deletePart:function(t){var e=this;this.HttpClient.post("/admin/source/del",{tag_id:t,relation_id:this.$route.query.aid}).then(function(a){console.log(a),200===a.data.code?(e.$message.success(a.data.msg),e.parts.map(function(a,i){a.source_id===t&&e.parts.splice(i,1)})):e.$message.error(a.data.msg)})},cancelModify:function(){this.$router.go(-1)},confirmModify:function(){var t=this;console.log(this.encyclopediaInfo),this.HttpClient.post("/admin/encyclopedias/edit",{id:this.encyclopediaInfo.id,title:this.encyclopediaInfo.title,cover:this.Tools.handleImg(this.encyclopediaInfo.cover[0].path),description:this.encyclopediaInfo.description,category_id:this.secondValue}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),setTimeout(function(){t.$router.go(-1)},500)):t.$message.error(e.data.msg)})}},created:function(){this.getEncyclopediaInfo()}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"encyclopediaData"},[a("BreadCrumb",{staticClass:"bread",attrs:{breadData:t.breadData}}),t._v(" "),a("div",{staticClass:"encyclopediaData_main"},[t._m(0),t._v(" "),a("div",{staticClass:"encyclopediaData_content"},[a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("标题")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},[a("el-input",{staticClass:"recipient_email",model:{value:t.encyclopediaInfo.title,callback:function(e){t.$set(t.encyclopediaInfo,"title",e)},expression:"encyclopediaInfo.title"}})],1)]),t._v(" "),a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("封面图片")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},[a("el-upload",{staticClass:"articleModify_uploader",attrs:{action:"/","show-file-list":!1,"on-success":t.handleCoverSuccess,"before-upload":t.beforeCoverUpload}},[t.encyclopediaInfo.cover?a("img",{staticClass:"articleModify_img",attrs:{src:t.Tools.handleImg(t.encyclopediaInfo.cover[0].path)}}):a("i",{staticClass:"el-icon-plus articleModify-icon"})])],1)]),t._v(" "),a("div",{staticClass:"encyclopedia_content_item encyclopedia_content_items"},[a("div",{staticClass:"encyclopedia_title"},[t._v("简介")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},[a("div",{staticClass:"encyclopedia_textarea"},[a("el-input",{staticClass:"recipient_email",attrs:{type:"textarea",autosize:{minRows:2,maxRows:10}},model:{value:t.encyclopediaInfo.description,callback:function(e){t.$set(t.encyclopediaInfo,"description",e)},expression:"encyclopediaInfo.description"}})],1)])]),t._v(" "),a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("一级目录")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},t._l(t.firstCatalogue,function(e,i){return a("div",{key:i,staticClass:"encyclopedia_first_catalogue"},[a("div",{key:e.id,staticClass:"encyclopedia_catalogue",class:{is_active:e.id===t.firstId},on:{click:function(a){t.firstClick(e.id,i)}}},[t._v(t._s(e.name))]),t._v(" "),a("el-button",{staticClass:"el-icon-edit",attrs:{type:"info"},on:{click:function(a){t.catalogueModify(e.catalog_id,e.content,e.name,!0)}}})],1)}))]),t._v(" "),t.firstId?a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("二级目录")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},t._l(t.secondCatalogue,function(e,i){return a("div",{key:i,staticClass:"encyclopedia_first_catalogue"},[a("div",{key:e.id,staticClass:"encyclopedia_catalogue",class:{is_active:e.id===t.secondId},on:{click:function(a){t.secondClick(e.id)}}},[t._v(t._s(e.name))]),t._v(" "),a("el-button",{staticClass:"el-icon-edit",attrs:{type:"info"},on:{click:function(a){t.catalogueModify(e.catalog_id,e.content,e.name,!1)}}})],1)}))]):t._e(),t._v(" "),a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("标签")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},t._l(t.tags,function(e,i){return a("div",{key:i,staticClass:"encyclopedia_first_catalogue"},[a("div",{key:e.id,staticClass:"encyclopedia_catalogue",on:{click:function(a){t.tagClick(e)}}},[t._v(t._s(e.name))]),t._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{type:"danger"},on:{click:function(a){t.deleteTag(e.tag_id)}}})],1)}))]),t._v(" "),t.parts&&t.parts.length>0?a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("文献")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},t._l(t.parts,function(e,i){return a("div",{key:i,staticClass:"encyclopedia_first_catalogue"},[a("div",{key:e.source_id,staticClass:"encyclopedia_catalogue",class:{is_active:t.partIndex===i},on:{click:function(e){t.partClick(i)}}},[t._v(t._s(e.source_name))]),t._v(" "),a("el-button",{staticClass:"el-icon-edit modify",attrs:{type:"info"},on:{click:function(a){t.z(e,i)}}}),t._v(" "),a("el-button",{staticClass:"el-icon-delete",attrs:{type:"danger"},on:{click:function(a){t.deletePart(e.source_id)}}})],1)}))]):t._e(),t._v(" "),t.parts&&t.parts.length>0?a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("对应链接")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},[a("el-input",{staticClass:"recipient_email",on:{change:t.linkModify},model:{value:t.parts[t.partIndex].link,callback:function(e){t.$set(t.parts[t.partIndex],"link",e)},expression:"parts[partIndex].link"}})],1)]):t._e(),t._v(" "),a("div",{staticClass:"encyclopedia_content_item"},[a("div",{staticClass:"encyclopedia_title"},[t._v("当前所属子目录")]),t._v(" "),a("div",{staticClass:"encyclopedia_body"},[a("el-select",{attrs:{placeholder:"建模"},on:{change:t.secondChangeFn},model:{value:t.secondValue,callback:function(e){t.secondValue=e},expression:"secondValue"}},t._l(t.secondData,function(t){return a("el-option",{key:t.menu_id,attrs:{label:t.name,value:t.menu_id}})}))],1)])]),t._v(" "),a("el-button",{on:{click:t.cancelModify}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.confirmModify}},[t._v("修改")])],1),t._v(" "),a("el-dialog",{attrs:{"custom-class":"catalogueModify",visible:t.catalogueVisible,width:"800px"},on:{"update:visible":function(e){t.catalogueVisible=e}}},[a("span",{staticClass:"modifyVisible_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-edit-square"}),t._v("目录修改\n    ")]),t._v(" "),a("div",{staticClass:"modifyVisible"},[a("div",{staticClass:"catalogue_name"},[t._v("新名称：")]),t._v(" "),a("div",[a("el-input",{model:{value:t.newCatalogueName,callback:function(e){t.newCatalogueName=e},expression:"newCatalogueName"}})],1)]),t._v(" "),a("div",{staticClass:"modifyVisible"},[a("div",{staticClass:"catalogue_name"},[t._v("内容：")]),t._v(" "),a("div",{staticClass:"catalogue_content"},[a("el-upload",{staticClass:"avatar-uploader up_content",attrs:{id:"xx",action:t.$uploadPath,data:t.contentUpData,name:"file","show-file-list":!1,"on-success":t.handleContentSuccess,"before-upload":t.beforeContentUpload}}),t._v(" "),a("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{blur:function(e){t.onEditorBlur(e)},focus:function(e){t.onEditorFocus(e)},change:function(e){t.onEditorChange(e,5e3)}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.catalogueVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.updateCatalogue}},[t._v("保 存")])],1)]),t._v(" "),a("el-dialog",{attrs:{"custom-class":"modifyDialog",visible:t.modifyVisible,width:"400px"},on:{"update:visible":function(e){t.modifyVisible=e}}},[a("span",{staticClass:"modifyVisible_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-edit-square"}),t._v("修改\n    ")]),t._v(" "),a("div",{staticClass:"modifyVisible"},[a("p",[t._v("新名称：")]),t._v(" "),a("div",[a("el-input",{model:{value:t.newName,callback:function(e){t.newName=e},expression:"newName"}})],1)]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.modifyVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.updateTag}},[t._v("保 存")])],1)]),t._v(" "),a("delete-modal",{ref:"delete",on:{doDelete:t.confirmDelete}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("p",[this._v("百科修改")])])}]};var y=a("VU/8")(_,v,!1,function(t){a("wUpv")},null,null);e.default=y.exports},wUpv:function(t,e){}});