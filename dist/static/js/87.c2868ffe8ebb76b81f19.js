webpackJsonp([87],{F7uG:function(e,t){},FNjo:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("lHA8"),i=a.n(n),l=a("Gu7T"),s=a.n(l),r=a("Xxa5"),o=a.n(r),c=a("exGp"),d=a.n(c),u=a("ZPfm"),p=new(a("GKmE").a),v={name:"EncyclopediaDistribution",components:{BreadCrumb:u.a},data:function(){return{breadData:[{id:1,name:"百科",urls:"/index/encyclopedia/encyclopedia",icon:"icon-home"},{id:2,name:"专业目录分配",urls:"/index/encyclopedia/encyclopediaDistribution",icon:"icon-home"}],tableData:[],total:0,pageSize:25,currentPage:1,searchObj:{},addDirectoryDialog:!1,sectorSelection:1,allDirectoryDialog:!1,carSelect:1,engineeringSelect:1,controlSelect:1,modifyObj:{},firstLevel:null,secondary:null,thirdLevel:null,menuList:[],firstMenuList:[],secondMenuList:[],thirdMenuList:[],addObj:{menu_id:"",relation_id:"",type:1,relation_type:8},plateList:[],childrenPlateList:[],allMenuList:[]}},created:function(){this.getTableList(null)},methods:{addModal:function(e){this.addDirectoryDialog=!0,this.modifyObj=e,this.getModelList()},viewModal:function(){},allModal:function(e){this.allDirectoryDialog=!0,this.modifyObj=e,this.allMenuList=this.modifyObj.menu},search:function(){this.getTableList(this.searchObj)},add:function(){var e=this;return d()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.addObj.relation_id=e.modifyObj.encyclopedia_id,t.next=3,e.HttpClient.post("/admin/menuRelationship/create",e.addObj);case 3:a=t.sent,p.getApiMessage(a),"200"==a.data.code&&(e.addDirectoryDialog=!1),setTimeout(function(){e.search()},500);case 7:case"end":return t.stop()}},t,e)}))()},currentChange:function(e){var t=this;return d()(o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.currentPage=e,t.search();case 2:case"end":return a.stop()}},a,t)}))()},changeModel:function(e,t){var a=this;return d()(o.a.mark(function n(){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("menu"!==e){n.next=5;break}return n.next=3,a.getFirstMenuList();case 3:n.next=13;break;case 5:if("firstMenu"!==e){n.next=10;break}return n.next=8,a.getSecondMenuList();case 8:n.next=13;break;case 10:if("secondMenu"!==e){n.next=13;break}return n.next=13,a.getThirdMenuList();case 13:a.addObj.menu_id=t.menu_id;case 14:case"end":return n.stop()}},n,a)}))()},getTableList:function(e){var t=this;return d()(o.a.mark(function a(){var n,i,l;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n={page:t.currentPage},e&&(n.title=e.topicSearch,n.start_time=e.startTime,n.end_time=e.endTime),a.next=4,t.HttpClient.post("/admin/encyclopedias/getListWithMajorMenu",n);case 4:i=a.sent,t.total=i.data.data.total,l=_(i.data.data.data),t.tableData=l.table,t.plateList=l.plateList,t.childrenPlateList=l.childrenPlateList;case 10:case"end":return a.stop()}},a,t)}))()},filterSecondary:function(e,t,a){return t[a.property]==e},filterAssign:function(e,t,a){return"未分配"==e?t.menu.length<1:"已分配"==e?t.menu.length>0:void 0},getModelList:function(){var e=this;return d()(o.a.mark(function t(){var a,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.HttpClient.post("/admin/menu/getList",{menu_type:3});case 2:a=t.sent,n=f(a.data.data),e.menuList=n.menuList,e.menuList[0]&&(e.muneId=e.menuList[0].menu_id,e.pid=e.muneId);case 6:case"end":return t.stop()}},t,e)}))()},getFirstMenuList:function(){var e=this;return d()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.HttpClient.post("/admin/menu/getOneChild",{menu_id:e.sectorSelection.menu_id,menu_type:3});case 2:a=t.sent,e.firstMenuList=a.data.data.child,e.secondMenuList=[],e.thirdMenuList=[],e.firstLevel=null,e.secondary=null,e.thirdLevel=null;case 9:case"end":return t.stop()}},t,e)}))()},getSecondMenuList:function(){var e=this;return d()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.HttpClient.post("/admin/menu/getOneChild",{menu_id:e.firstLevel.menu_id,menu_type:3});case 2:a=t.sent,e.secondMenuList=a.data.data.child,e.thirdMenuList=[],e.secondary=null,e.thirdLevel=null;case 7:case"end":return t.stop()}},t,e)}))()},getThirdMenuList:function(){var e=this;return d()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.HttpClient.post("/admin/menu/getOneChild",{menu_id:e.secondary.menu_id,menu_type:3});case 2:a=t.sent,e.thirdMenuList=a.data.data.child;case 4:case"end":return t.stop()}},t,e)}))()}}};function _(e){var t=[],a=[];if(e&&e.length>0)for(var n in e){var l=e[n].menu;if(l&&l.length>0){var r=l[l.length-1];if(r&&r.length>0)for(var o in r)1==r[o].type?e[n].firstMenu=r[o].name:2==r[o].type?e[n].secondMenu=r[o].name:3==r[o].type&&(e[n].thirdMenu=r[o].name)}var c=e[n].category;c&&(c.folder_name&&(e[n].folder_name=c.folder_name,t.push(c.folder_name)),c.menu_1_name&&(e[n].menu_1_name=c.menu_1_name,a.push(c.menu_1_name)))}for(var d in t=[].concat(s()(new i.a(t))),a=[].concat(s()(new i.a(a))),t)t[d]={text:t[d],value:t[d]};for(var u in a)a[u]={text:a[u],value:a[u]};return{table:e,plateList:t,childrenPlateList:a}}function f(e){var t=[];if(e)for(var a in e)"0"==e[a].type&&t.push(e[a]);return{menuList:t}}var m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"encyclopediaDistribution"},[a("BreadCrumb",{staticClass:"bread",attrs:{breadData:e.breadData}}),e._v(" "),a("div",{staticClass:"encyclopedia_main"},[e._m(0),e._v(" "),a("div",{staticClass:"encyclopedia_header"},[a("div",{staticClass:"encyclopedia_select"},[a("div",{staticClass:"date_item"},[a("p",{staticClass:"date_label"},[e._v("开始")]),e._v(" "),a("el-date-picker",{staticClass:"date_picker_1",attrs:{type:"date",size:"mini",placeholder:"选择日期"},model:{value:e.searchObj.startTime,callback:function(t){e.$set(e.searchObj,"startTime",t)},expression:"searchObj.startTime"}})],1),e._v(" "),a("div",{staticClass:"date_item"},[a("p",{staticClass:"date_label"},[e._v("截止")]),e._v(" "),a("el-date-picker",{staticClass:"date_picker_1",attrs:{type:"date",size:"mini",placeholder:"选择日期"},model:{value:e.searchObj.endTime,callback:function(t){e.$set(e.searchObj,"endTime",t)},expression:"searchObj.endTime"}})],1)]),e._v(" "),a("div",{staticClass:"encyclopedia_search"},[a("div",[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"标题搜索"},model:{value:e.searchObj.topicSearch,callback:function(t){e.$set(e.searchObj,"topicSearch",t)},expression:"searchObj.topicSearch"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1)])]),e._v(" "),a("div",{staticClass:"encyclopedia_content"},[a("el-table",{attrs:{data:e.tableData,border:!0}},[a("el-table-column",{attrs:{label:"ID",align:"center","show-overflow-tooltip":"",width:"80",prop:"id",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"百科标题",align:"center",width:"280","show-overflow-tooltip":"",prop:"title"}}),e._v(" "),a("el-table-column",{attrs:{label:"所属板块",align:"center","show-overflow-tooltip":"",filters:e.plateList,"filter-method":e.filterSecondary,width:"140",prop:"folder_name"}}),e._v(" "),a("el-table-column",{attrs:{label:"子类板块",align:"center",filters:e.childrenPlateList,"filter-method":e.filterSecondary,prop:"menu_1_name","show-overflow-tooltip":"",width:"140"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否分配",align:"center","show-overflow-tooltip":"",filters:[{text:"已分配",value:"已分配"},{text:"未分配",value:"未分配"}],"filter-method":e.filterAssign,prop:"menu.length",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.menu.length>0?a("span",[e._v("已分配")]):e._e(),e._v(" "),0==t.row.menu.length?a("span",[e._v("未分配")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"通过时间",align:"center",width:"170","show-overflow-tooltip":"",prop:"created_at",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"一级目录",align:"center","show-overflow-tooltip":"",width:"150",prop:"firstMenu"}}),e._v(" "),a("el-table-column",{attrs:{label:"二级目录",align:"center","show-overflow-tooltip":"",width:"150",prop:"secondMenu"}}),e._v(" "),a("el-table-column",{attrs:{label:"三级目录",align:"center","show-overflow-tooltip":"",width:"150",prop:"thirdMenu"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"200","class-name":"encyclopedia_scope"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"encyclopedia_btm"},[a("el-button",{attrs:{size:"medium",type:"text"},on:{click:function(a){e.addModal(t.row)}}},[e._v("添加目录")]),e._v(" "),a("el-button",{attrs:{size:"medium",type:"text"},on:{click:function(a){e.viewModal(t.row)}}},[e._v("预览")]),e._v(" "),a("el-button",{attrs:{size:"medium",type:"text"},on:{click:function(a){e.allModal(t.row)}}},[e._v("所有目录")])],1)]}}])})],1),e._v(" "),e.total?a("el-pagination",{attrs:{layout:"prev, pager, next",total:e.total,"page-size":e.pageSize},on:{"current-change":e.currentChange}}):e._e()],1)]),e._v(" "),a("el-dialog",{attrs:{width:"800px","custom-class":"addDirectoryDialog",visible:e.addDirectoryDialog},on:{"update:visible":function(t){e.addDirectoryDialog=t}}},[a("span",{staticClass:"addDirectoryDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-jia-xianxingfangkuang"}),e._v("添加目录")]),e._v(" "),a("div",{staticClass:"addDirectoryDialog_box"},[a("div",{staticClass:"box_list"},[a("div",{staticClass:"box_list_title"},[e._v("学科板块：")]),e._v(" "),a("div",{staticClass:"box_list_main"},[a("el-radio-group",{model:{value:e.sectorSelection,callback:function(t){e.sectorSelection=t},expression:"sectorSelection"}},e._l(e.menuList,function(t,n){return a("el-radio",{key:n,attrs:{label:t},on:{change:function(a){e.changeModel("menu",t)}}},[e._v(e._s(t.name))])}))],1)]),e._v(" "),a("div",{staticClass:"box_list"},[a("div",{staticClass:"box_list_title"},[e._v("一级目录：")]),e._v(" "),a("div",{staticClass:"box_list_main"},[a("el-radio-group",{model:{value:e.firstLevel,callback:function(t){e.firstLevel=t},expression:"firstLevel"}},e._l(e.firstMenuList,function(t,n){return a("el-radio",{key:n,attrs:{label:t},on:{change:function(a){e.changeModel("firstMenu",t)}}},[e._v(e._s(t.name))])}))],1)]),e._v(" "),a("div",{staticClass:"box_list"},[a("div",{staticClass:"box_list_title"},[e._v("二级目录：")]),e._v(" "),a("div",{staticClass:"box_list_main"},[a("el-radio-group",{model:{value:e.secondary,callback:function(t){e.secondary=t},expression:"secondary"}},e._l(e.secondMenuList,function(t,n){return a("el-radio",{key:n,attrs:{label:t},on:{change:function(a){e.changeModel("secondMenu",t)}}},[e._v(e._s(t.name))])}))],1)]),e._v(" "),a("div",{staticClass:"box_list"},[a("div",{staticClass:"box_list_title"},[e._v("三级目录：")]),e._v(" "),a("div",{staticClass:"box_list_main"},[a("el-radio-group",{model:{value:e.thirdLevel,callback:function(t){e.thirdLevel=t},expression:"thirdLevel"}},e._l(e.thirdMenuList,function(t,n){return a("el-radio",{key:n,attrs:{label:t},on:{change:function(a){e.changeModel("thirdMenu",t)}}},[e._v(e._s(t.name))])}))],1)])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addDirectoryDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("添 加")])],1)]),e._v(" "),a("el-dialog",{attrs:{width:"800px","custom-class":"allDirectoryDialog",visible:e.allDirectoryDialog},on:{"update:visible":function(t){e.allDirectoryDialog=t}}},[a("span",{staticClass:"allDirectoryDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-jia-xianxingfangkuang"}),e._v("所有目录")]),e._v(" "),a("div",{staticClass:"allDirectoryDialog_box"},e._l(e.allMenuList,function(t){return a("div",{key:t,staticClass:"box_list"},e._l(t,function(t,n){return a("div",{key:n},[a("div",{staticClass:"box_list_title"},[e._v(e._s(t.name))])])}))})),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.allDirectoryDialog=!1}}},[e._v("关闭")])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"encyclopedia_title"},[t("div",{staticClass:"title"},[this._v("专业目录分配")])])}]};var h=a("VU/8")(v,m,!1,function(e){a("F7uG")},null,null);t.default=h.exports}});