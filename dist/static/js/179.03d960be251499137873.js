webpackJsonp([179],{"0IUC":function(t,i){},nRqN:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("//Fk"),s=e.n(a),o=(e("G0J2"),e("yPE/")),n=(e("PJh5"),e("AJTU")),l=e.n(n),c=e("37tQ"),r=e("GH0r");o.register("modules/imageResize",l.a),o.register("modules/imageDrop",c.a);var d=["10px","12px","14px","16px","18px","20px"],u=o.import("attributors/style/size");u.whitelist=d,o.register(u,!0);o.import("formats/font").whitelist=["SimSun","SimHei","Microsoft-YaHei","KaiTi","FangSong","Arial","Times-New-Roman","sans-serif"],o.register("modules/ImageExtend",r.a);var g=[["italic","underline","strike","bold"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:d}],[{color:[]}],[{align:[]}],["image"]],f={name:"ArticleModify",data:function(){var t=this;return{id:"",imageUrl:"",tags:[],name:"",tag_id:"",part:[],link:"",modifyVisible:!1,articleData:{id:"",title:"",image_path:"",profile:"",content:"",category_id:"",status:1},editorOption:{modules:{toolbar:{container:g,handlers:{image:function(t){t?document.querySelector("#xx input").click():this.quill.format("image",!1)}}},imageDrop:!0,imageResize:{displayStyles:{backgroundColor:"black",border:"none",color:"white"},modules:["Resize","DisplaySize","Toolbar"]},ImageExtend:{loading:!0,name:"img",size:1,action:"",response:function(t){return t.info},headers:function(t){},sizeError:function(){t.$message.error("图片大小超过限制1M")},start:function(){},end:function(){},error:function(){},success:function(){},change:function(t,i){}}}},contentUpData:{},content:""}},methods:{handleAvatarSuccess:function(t,i){this.imageUrl=URL.createObjectURL(i.raw)},beforeAvatarUpload:function(t){var i=this,e="image/jpeg"===t.type,a=t.size/1024;e||this.$message.error("上传图片只能是 JPG 格式!"),a||this.$message.error("上传图片大小不能超过 1MB!"),console.log(t),this.HttpClient.form("/admin/uploadOneImage",{images:t}).then(function(t){console.log(t.data),200===t.data.code&&(i.$message.success(t.data.msg),i.articleData.image_path=t.data.path.replace("http://cdn.kushualab.com/",""),console.log(i.articleData),setTimeout(function(){i.HttpClient.post("/admin/article/edit",i.articleData).then(function(t){console.log(t),200===t.data.code?i.$message.success(t.data.msg):i.$message.error(t.data.msg)})},500))})},getArticleDetails:function(){var t=this;this.HttpClient.post("/admin/article/getInfo",{id:this.$route.query.id}).then(function(i){console.log(i);var e=i.data,a=e.code,s=e.data;200===a&&(t.articleData.title=s.title,t.articleData.image_path=s.image_path,t.articleData.profile=s.profile,t.articleData.content=s.content,t.content=s.content,t.articleData.category_id=s.category_id,t.tags=s.label,t.part=s.source)})},updateButton:function(t){this.modifyVisible=!0,this.tag_id=t},updateTag:function(){var t=this;this.modifyVisible=!1,this.HttpClient.post("/admin/tags/edit",{relation_id:this.id,name:this.name,tag_id:this.tag_id}).then(function(i){console.log(i),200===i.data.code?(t.$message.success(i.data.msg),setTimeout(function(){t.getArticleDetails()},500)):t.$message.error(i.data.msg)})},deleteTags:function(t,i){var e=this;this.HttpClient.post("/admin/tags/del",{relation_id:this.id,tag_id:i}).then(function(i){console.log(i),200===i.data.code?(e.$message.success("删除成功"),e.tags.splice(t,1)):e.$message.error("删除成功")})},onEditorBlur:function(){},onEditorFocus:function(){},onEditorChange:function(t,i){console.log(this.content);var e,a=this.content;console.log((e=a,e=(e=(e=(e=e.replace(/<\/?[^>]*>/g,"")).replace(/[ | ]*\n/g,"\n")).replace(/\n[\s| | ]*\r/g,"\n")).replace(/ /gi,"")).length),t.quill.deleteText(i,1),this.$emit("Quescthon",this.content),console.log(this.content);var s=this.Tools.getEditorImageAndLength(this.content);this.editImageSize=s.imgArray.length,console.log(this.modifyData)},beforeContentUpload:function(t){var i=t.size/1024/1024<10,e=t.name.split(".")[1];if("jpg,png,jpeg,tiff,tif".indexOf(e)<0)return this.$message.error("图片类型只能为jpg,png,jpeg,tiff,tif"),!1;if(!i)return this.$message.error("上传图片大小不能超过 5MB!"),!1;var a=this,o=new FileReader;return o.readAsDataURL(t),new s.a(function(i,e){o.onload=function(){a.contentUpData.token=a.$getQiNiuToken({saveKey:t.name}),i(!0)}})},handleContentSuccess:function(t,i,e){console.log(t,i,e);var a=this.$refs.myQuillEditor.quill,s=a.getSelection().index;a.insertEmbed(s,"image",this.$imagePath+i.response.key),a.setSelection(s+1)},updatePart:function(t){this.modifyVisible=!1},deletePart:function(){},submitArticle:function(){var t=this;this.HttpClient.post("/admin/article/edit",this.articleData).then(function(i){console.log(i),200===i.data.code?(t.$message.success(i.data.msg),setTimeout(function(){t.$router.go(-1)},500)):t.$message.error(i.data.msg)})}},created:function(){this.articleData.id=this.$route.query.id,this.id=this.$route.query.articleId,console.log(this.id),this.getArticleDetails()}},m={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"articleModify"},[e("div",{staticClass:"articleModify_header"},[t._v(t._s(t.articleData.title)+" - 修改")]),t._v(" "),e("div",{staticClass:"articleModify_main"},[e("div",{staticClass:"articleModify_List"},[e("div",{staticClass:"list_title"},[t._v("标题")]),t._v(" "),e("div",{staticClass:"list_input"},[e("el-input",{model:{value:t.articleData.title,callback:function(i){t.$set(t.articleData,"title",i)},expression:"articleData.title"}})],1)]),t._v(" "),e("div",{staticClass:"articleModify_List"},[e("div",{staticClass:"list_title"},[t._v("封面图片")]),t._v(" "),e("div",{staticClass:"list_input list_upload"},[e("el-upload",{staticClass:"articleModify_uploader",attrs:{action:"/","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload}},[t.articleData.image_path?e("img",{staticClass:"articleModify_img",attrs:{src:t.Tools.handleImg(t.articleData.image_path)}}):e("i",{staticClass:"el-icon-plus articleModify-icon"})]),t._v(" "),e("p",[t._v("(图片比例4:3，大小不超过1M)")])],1)]),t._v(" "),e("div",{staticClass:"articleModify_List"},[e("div",{staticClass:"list_title"},[t._v("简介")]),t._v(" "),e("div",{staticClass:"list_input list_textarea"},[e("el-input",{attrs:{type:"textarea",rows:5,resize:"none"},model:{value:t.articleData.profile,callback:function(i){t.$set(t.articleData,"profile",i)},expression:"articleData.profile"}})],1)]),t._v(" "),e("div",{staticClass:"articleModify_List"},[e("div",{staticClass:"list_title"},[t._v("详细内容")]),t._v(" "),e("div",{staticClass:"list_input list_textarea"},[e("div",{staticClass:"mail_edit"},[e("i",{staticClass:"iconfont icon-huaban4"}),t._v(" "),e("div",{staticClass:"mail_edit_body"},[e("el-upload",{staticClass:"avatar-uploader up_content",attrs:{id:"xx",action:t.$uploadPath,data:t.contentUpData,name:"file","show-file-list":!1,"on-success":t.handleContentSuccess,"before-upload":t.beforeContentUpload}}),t._v(" "),e("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{blur:function(i){t.onEditorBlur(i)},focus:function(i){t.onEditorFocus(i)},change:function(i){t.onEditorChange(i,5e3)}},model:{value:t.content,callback:function(i){t.content=i},expression:"content"}})],1)])])]),t._v(" "),e("div",{staticClass:"articleModify_List"},[e("div",{staticClass:"list_title"},[t._v("标签")]),t._v(" "),e("div",{staticClass:"list_input list_tags"},t._l(t.tags,function(i,a){return e("div",{key:a,staticClass:"tags"},[e("div",{on:{click:function(e){t.updateButton(i.tag_id)}}},[t._v(t._s(i.name))]),t._v(" "),e("p",{on:{click:function(e){t.deleteTags(a,i.tag_id)}}},[e("i",{staticClass:"iconfont icon-minus"})])])}))])]),t._v(" "),e("el-dialog",{attrs:{"custom-class":"modifyDialog",visible:t.modifyVisible,width:"400px"},on:{"update:visible":function(i){t.modifyVisible=i}}},[e("span",{staticClass:"modifyVisible_title",attrs:{slot:"title"},slot:"title"},[e("i",{staticClass:"iconfont icon-edit-square"}),t._v("修改\n    ")]),t._v(" "),e("div",{staticClass:"modifyVisible"},[e("p",[t._v("新名称：")]),t._v(" "),e("div",[e("el-input",{model:{value:t.name,callback:function(i){t.name=i},expression:"name"}})],1)]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(i){t.modifyVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.updateTag}},[t._v("保 存")])],1)]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.submitArticle}},[t._v("修改")])],1)},staticRenderFns:[]};var p=e("VU/8")(f,m,!1,function(t){e("0IUC")},null,null);i.default=p.exports}});