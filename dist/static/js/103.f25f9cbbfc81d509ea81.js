webpackJsonp([103],{6516:function(t,e){},"94D1":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("gRE1"),s=a.n(i),l=a("ZPfm"),o=a("+jNi"),n={name:"ServiceApplication",components:{BreadCrumb:l.a,ModalDelete:o.a},data:function(){return{breadData:[{id:1,name:"服务",urls:"/index/service/service",icon:"icon-home"},{id:2,name:"新服务申请",urls:"/index/service/ServiceApplication",icon:"icon-home"}],plateOptions:[],levelOptions:[],statusOptions:[{value:0,label:"删除"},{value:1,label:"正常"},{value:2,label:"下架"},{value:3,label:"待提交"},{value:4,label:"未通过"},{value:5,label:"待审核"}],serviceName:"",companyName:"",tableData:[],reviewDialog:!1,remarkDialog:!1,remark:"",basicInfoDialog:!1,dialogImageUrl:"",dialogVisible:!1,rejectVisible:!1,imagesVisible:!1,imageUrl:"",basicData:{},plateValue:"",levelValue:"",statusValue:"",currentPage:1,pageSize:25,total:0,id:"",protocols:[],images:[],historyData:[]}},methods:{handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},uploadProtocol:function(t){var e=this;console.log(t),this.HttpClient.form("/admin/uploadOneFile",{files:t}).then(function(a){console.log(a),200===a.data.code?(e.$message.success(a.data.msg),e.protocols.push({name:t.name,url:a.data.path})):e.$message.error(a.data.msg),console.log(e.protocols)})},uploadFile:function(t){var e=this;console.log(t),this.HttpClient.form("/admin/uploadOneImage",{images:t}).then(function(a){console.log(a),200===a.data.code?(e.$message.success(a.data.msg),e.images.push({name:t.name,url:a.data.path})):e.$message.error(a.data.msg),console.log(e.images)})},removeProtocol:function(t,e){var a=this;this.protocols.map(function(e,i){e.uid===t.uid&&a.protocols.splice(i,1)}),console.log(this.protocols)},removeFile:function(t,e){var a=this;this.images.map(function(e,i){e.uid===t.uid&&a.images.splice(i,1)}),console.log(this.images)},getApplyList:function(){var t=this,e={page:this.currentPage,size:this.pageSize};""!==this.statusValue&&(e.status=this.statusValue),this.levelValue&&(e.menu=this.levelValue),this.serviceName&&(e.title=this.serviceName),this.companyName&&(e.company_name=this.companyName),console.log(this.statusValue),console.log(e),this.HttpClient.post("/admin/services/listsWithMenu",e).then(function(e){console.log(e),200===e.data.code&&(t.tableData=e.data.data.data,t.total=e.data.data.total,t.tableData.map(function(t){t.price=Number(t.price)}))})},getTypeList:function(){var t=this;this.HttpClient.post("/admin/menu/getList",{menu_type:2,type:3}).then(function(e){console.log(e),200===e.data.code&&(t.plateOptions=s()(e.data.data),console.log(t.plateOptions))})},getBasicInfo:function(){var t=this;this.HttpClient.post("/admin/services/baseInfo",{id:this.id}).then(function(e){console.log(e),200===e.data.code&&(t.basicData=e.data.data,console.log(t.basicData.admin_upload_images),console.log(t.basicData))})},getRemarkList:function(t){var e=this;this.HttpClient.post("/admin/remarkLog/lists",{source_id:t}).then(function(t){console.log(t),200===t.data.code?(e.historyData=t.data.data,e.$set(e.historyData,e.historyData.length-1,e.historyData[e.historyData.length-1])):e.historyData=[]})},plateChange:function(){console.log("4111111"),this.levelValue="",""!==this.plateValue&&(this.levelOptions=this.plateOptions[this.plateValue].child)},basicButton:function(t){this.id=t,this.basicInfoDialog=!0,this.getBasicInfo()},rejectButton:function(t){this.rejectVisible=!0,this.id=t,this.getBasicInfo()},previewButton:function(t){console.log(t)},examineButton:function(t){this.reviewDialog=!0,this.id=t},deleteButton:function(t){this.id=t,this.$refs.delete.deleteDialog=!0},remarkButton:function(t){this.id=t,this.remarkDialog=!0,this.getRemarkList(t)},handleExamine:function(){var t=this;this.HttpClient.post("/admin/protocol/create",{protocols:this.protocols,images:this.images,source_id:this.id,type:"services"}).then(function(e){console.log(e),200===e.data.code?(t.reviewDialog=!1,t.$message.success(e.data.msg),setTimeout(function(){t.getApplyList()},500)):t.$message.error(e.data.msg)})},confirmDelete:function(){var t=this;this.HttpClient.post("/admin/services/changeStatus",{status:0,service_id:this.id}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),setTimeout(function(){t.getApplyList()},500)):t.$message.error(e.data.msg)})},addRemark:function(){var t=this;this.HttpClient.post("/admin/remarkLog/create",{content:this.remark,source_id:this.id}).then(function(e){console.log(e),200===e.data.code?(t.$message.success(e.data.msg),t.remark="",setTimeout(function(){t.getRemarkList(t.id)},500)):t.$message.error(e.data.msg)})},checkImages:function(t){this.imageUrl=t,this.imagesVisible=!0},currentChange:function(t){this.currentPage=t,this.getApplyList()}},created:function(){this.getApplyList(),this.getTypeList()}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"serviceApplication"},[a("BreadCrumb",{staticClass:"bread",attrs:{breadData:t.breadData}}),t._v(" "),a("div",{staticClass:"service_main"},[t._m(0),t._v(" "),a("div",{staticClass:"service_header"},[a("div",{staticClass:"service_select"},[a("el-select",{staticClass:"select_normal",attrs:{clearable:"",placeholder:"板块"},on:{change:t.plateChange},model:{value:t.plateValue,callback:function(e){t.plateValue=e},expression:"plateValue"}},t._l(t.plateOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:e}})})),t._v(" "),""!==t.plateValue?a("el-select",{staticClass:"select_normal",attrs:{clearable:"",placeholder:"二级"},on:{change:t.getApplyList},model:{value:t.levelValue,callback:function(e){t.levelValue=e},expression:"levelValue"}},t._l(t.levelOptions,function(t){return a("el-option",{key:t.menu_id,attrs:{label:t.name,value:t.menu_id}})})):t._e(),t._v(" "),a("el-select",{staticClass:"select_normal",attrs:{clearable:"",placeholder:"状态"},on:{change:t.getApplyList,clear:t.getApplyList},model:{value:t.statusValue,callback:function(e){t.statusValue=e},expression:"statusValue"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("div",{staticClass:"service_search"},[a("div",[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"服务名称",clearable:""},on:{clear:t.getApplyList},nativeOn:{keyup:function(e){return"button"in e||13===e.keyCode?t.getApplyList(e):null}},model:{value:t.serviceName,callback:function(e){t.serviceName=e},expression:"serviceName"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.getApplyList},slot:"append"})],1)],1),t._v(" "),a("div",[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"公司对外名称",clearable:""},on:{clear:t.getApplyList},nativeOn:{keyup:function(e){return"button"in e||13===e.keyCode?t.getApplyList(e):null}},model:{value:t.companyName,callback:function(e){t.companyName=e},expression:"companyName"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.getApplyList},slot:"append"})],1)],1)])]),t._v(" "),a("div",{staticClass:"service_content"},[a("el-table",{staticStyle:{width:"95%"},attrs:{data:t.tableData,border:!0}},[a("el-table-column",{attrs:{label:"ID",prop:"id",align:"center",width:"65",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{label:"服务名称",align:"center","show-overflow-tooltip":"",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(e.row.title))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"公司对外名称",align:"center","show-overflow-tooltip":"",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.company_name?a("p",[t._v(t._s(e.row.company_name))]):a("p",{staticClass:"sortout_color"},[t._v("无")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"价格",prop:"price",align:"center","show-overflow-tooltip":"",width:"100",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{label:"板块",align:"center","column-key":"date","show-overflow-tooltip":"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.folder?a("p",[t._v(t._s(e.row.folder))]):a("p",{staticClass:"sortout_color"},[t._v("无")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"二级",align:"center","show-overflow-tooltip":"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(e.row.menu_name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"城市",align:"center","show-overflow-tooltip":"",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(e.row.city_name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"申请时间",prop:"created_at",align:"center","show-overflow-tooltip":"",width:"160",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{label:"状态",align:"center","show-overflow-tooltip":"",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.status?a("p",{staticClass:"sortout_color"},[t._v("删除")]):1===e.row.status?a("p",{staticClass:"normal_color"},[t._v("正常")]):2===e.row.status?a("p",{staticClass:"sortout_color"},[t._v("下架")]):3===e.row.status?a("p",{staticClass:"audit_color"},[t._v("待提交")]):4===e.row.status?a("p",{staticClass:"notpass_color"},[t._v("未通过")]):5===e.row.status?a("p",[t._v("待审核")]):a("p",{staticClass:"sortout_color"},[t._v("无")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",fixed:"right",width:"400px","class-name":"service_scope"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"service_btm"},[a("div",{on:{click:function(a){t.basicButton(e.row.id)}}},[t._v("基本信息")]),t._v(" "),4===e.row.status?a("div",{on:{click:function(a){t.rejectButton(e.row.id)}}},[t._v("查看反馈")]):t._e(),t._v(" "),a("div",{on:{click:function(a){t.previewButton(e.row)}}},[t._v("预览服务")]),t._v(" "),3===e.row.status||4===e.row.status?a("div",{on:{click:function(a){t.examineButton(e.row.service_id)}}},[t._v("提交审核")]):t._e(),t._v(" "),4===e.row.status?a("div",{on:{click:function(a){t.deleteButton(e.row.service_id)}}},[t._v("删除")]):t._e(),t._v(" "),a("div",{on:{click:function(a){t.remarkButton(e.row.service_id)}}},[t._v("添加备注")])])]}}])})],1),t._v(" "),t.total?a("el-pagination",{attrs:{layout:"prev, pager, next",total:t.total,"page-size":t.pageSize},on:{"current-change":t.currentChange}}):t._e()],1)]),t._v(" "),a("ModalDelete",{ref:"delete",on:{doDelete:t.confirmDelete}}),t._v(" "),a("el-dialog",{attrs:{visible:t.reviewDialog,width:"470px","custom-class":"reviewDialog"},on:{"update:visible":function(e){t.reviewDialog=e}}},[a("span",{staticClass:"reviewDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-huaban4"})]),t._v(" "),a("div",{staticClass:"reviewDialog_main upload"},[a("el-upload",{staticClass:"reviewUpload",attrs:{drag:"",action:"/","file-list":t.protocols,"on-remove":t.removeProtocol,"before-upload":t.uploadProtocol,multiple:""}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("上传安全协议")])]),t._v(" "),a("div",{staticClass:"annex"},[a("el-upload",{attrs:{action:"/","list-type":"picture-card","file-list":t.images,"on-preview":t.handlePictureCardPreview,"on-remove":t.removeFile,"before-upload":t.uploadFile}},[a("i",{staticClass:"el-icon-plus"})]),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("上传的附件"),a("br"),t._v("图片为此公司现场的图片，或者计划书等")]),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.reviewDialog=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleExamine}},[t._v("确 定")])],1)]),t._v(" "),a("el-dialog",{attrs:{visible:t.remarkDialog,width:"470px","custom-class":"remarkDialog"},on:{"update:visible":function(e){t.remarkDialog=e}}},[a("span",{staticClass:"remarkDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-huaban4"})]),t._v(" "),a("div",{staticClass:"remarkDialog_main"},[a("div",{staticClass:"remarkTitle"},[t._v("内容")]),t._v(" "),a("div",{staticClass:"remarkInput"},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入内容"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),t._v(" "),a("div",{staticClass:"remarkTitle"},[t._v("历史")]),t._v(" "),a("div",{staticClass:"remarkHistory"},t._l(t.historyData,function(e,i){return a("div",{key:i},[a("div",{staticClass:"remarkHistoryUser"},[a("i",{staticClass:"iconfont icon-dian"}),a("p",[t._v(t._s(e.name))]),a("span",[t._v(t._s(e.created_at))])]),t._v(" "),a("p",[t._v(t._s(e.content))])])}))]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.remarkDialog=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.addRemark}},[t._v("提 交")])],1)]),t._v(" "),a("el-dialog",{attrs:{visible:t.basicInfoDialog,width:"700px","custom-class":"basicInfoDialog"},on:{"update:visible":function(e){t.basicInfoDialog=e}}},[a("span",{staticClass:"basicInfoDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-huaban4"})]),t._v(" "),a("div",{staticClass:"basicInfoDialog_main"},[a("div",{staticClass:"main_list"},[a("div",{staticClass:"main_list_input"},[a("p",[t._v("板块：")]),t._v(" "),a("div",[t._v(t._s(t.basicData.menu?t.basicData.menu.folder_name:""))])]),t._v(" "),a("div",{staticClass:"main_list_input"},[a("p",[t._v("二级目录：")]),t._v(" "),a("div",[t._v(t._s(t.basicData.menu?t.basicData.menu.menu_1_name:""))])])]),t._v(" "),a("div",{staticClass:"main_list"},[a("div",{staticClass:"main_list_input"},[a("p",[t._v("城市：")]),t._v(" "),a("div",[t._v(t._s(t.basicData.city_name||"无"))])]),t._v(" "),a("div",{staticClass:"main_list_input"},[a("p",[t._v("详细地址：")]),t._v(" "),a("div",[t._v(t._s(t.basicData.address))])])]),t._v(" "),a("div",{staticClass:"main_list"},[a("div",{staticClass:"main_list_input"},[a("p",[t._v("负责人：")]),t._v(" "),a("div",[t._v(t._s(t.basicData.promotee))])]),t._v(" "),a("div",{staticClass:"main_list_input"},[a("p",[t._v("电话：")]),t._v(" "),a("div",[t._v(t._s(t.basicData.telphone))])])]),t._v(" "),a("div",{staticClass:"upload"},[a("div",{staticClass:"protocol"},[t.basicData.admin_upload_protocol?t._e():a("div",{staticClass:"el-upload__text"},[t._v("上传的安全协议")]),t._v(" "),t._l(t.basicData.admin_upload_protocol,function(e,i){return a("a",{key:e.uid,staticClass:"uploaded_protocol",attrs:{href:e.url+"?attname="}},[t._v(t._s(i+1)+"."+t._s(e.name))])})],2),t._v(" "),a("div",{staticClass:"annex"},[t.basicData.admin_upload_images?t._e():a("div",{staticClass:"el-upload__text"},[t._v("上传的附件"),a("br"),t._v("图片为此公司现场的图片，或者计划书等")]),t._v(" "),t._l(t.basicData.admin_upload_images,function(e){return a("img",{key:e.uid,staticClass:"el-upload__text",attrs:{src:e.url+"?imageView2/1/w/60/h/60"},on:{click:function(a){t.checkImages(e.url)}}})}),t._v(" "),a("el-dialog",{attrs:{visible:t.imagesVisible,"append-to-body":""},on:{"update:visible":function(e){t.imagesVisible=e}}},[a("img",{attrs:{width:"100%",src:t.imageUrl,alt:""}})])],2)])])]),t._v(" "),a("el-dialog",{attrs:{visible:t.rejectVisible,"custom-class":"disableDialog",width:"360px"},on:{"update:visible":function(e){t.rejectVisible=e}}},[a("span",{staticClass:"disableDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-jinyong"}),t._v("反馈")]),t._v(" "),a("div",{staticClass:"disable_dialog_box"},[a("div",{staticClass:"disable_dialog_left"},[t._v("理由：")]),t._v(" "),a("div",{staticClass:"disable_dialog_right"},[t._v("\n              "+t._s(t.basicData.refuse)+"\n          ")])]),t._v(" "),a("div",{staticClass:"disable_dialog_box"},[a("div",{staticClass:"disable_dialog_left"},[t._v("类别：")]),t._v(" "),a("div",{staticClass:"disable_dialog_right"},[t._v(t._s(t.basicData.review_name))])]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.rejectVisible=!1}}},[t._v("关闭")])],1)])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"service_title"},[e("div",{staticClass:"title"},[this._v("新服务申请")]),this._v(" "),e("div",{staticClass:"refresh"},[e("i",{staticClass:"iconfont icon-shuaxin"}),e("span",[this._v("刷新")])])])}]};var r=a("VU/8")(n,c,!1,function(t){a("6516")},null,null);e.default=r.exports}});