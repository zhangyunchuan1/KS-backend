webpackJsonp([232],{"7wn1":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={name:"UserActivity",components:{BreadCrumb:a("ZPfm").a},data:function(){return{breadData:[{id:1,name:"用户管理",urls:"/index/standardUser/StandardUser",icon:"icon-home"},{id:2,name:"用户账户",urls:"/index/standardUser/userManagement/UserManagement",icon:"icon-home"},{id:3,name:"用户活跃度",urls:"/index/standardUser/userManagement/UserActivity",icon:"icon-home"}],nickNameSearch:"",userNameSearch:"",messageContent:"",userID:"",tableData:[],chatDialog:!1,total:0,currentPage:1,messageData:[],totalmessage:0,currentmessagePage:1}},mounted:function(){this.initData()},methods:{timestampToTime:function(e){var t=new Date(1e3*e);return t.getFullYear()+"-"+((t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-")+((t.getDate()<10?"0"+t.getDate():t.getDate())+" ")+((t.getHours()<10?"0"+t.getHours():t.getHours())+":")+((t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":")+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},handleCurrentmessageChange:function(e){this.currentmessagePage=e,this.getmessageList()},getmessageList:function(){var e=this;this.HttpClient.post("/admin/user/message",{user_id:this.userID,page_size:4,page:this.currentmessagePage}).then(function(t){e.messageData=t.data.data,e.totalmessage=t.data.total,e.messageData.forEach(function(t){t.send_time=e.timestampToTime(t.send_time)}),console.log(e.messageData)})},initData:function(){var e=this,t={nickname:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",user_name:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",page:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1};this.HttpClient.post("/admin/users/liveness",t).then(function(t){if(200===t.data.code){var a=t.data.data,s=a.data,n=a.total,i=a.current_page;s&&(e.tableData=s,e.total=n,e.currentPage=i)}else e.$message.error(t.data.msg)})},handleCurrentChange:function(e){this.initData("","",e)},sendMessageFn:function(e){this.messageInfo=e,this.chatDialog=!0,this.userID=e.uid,this.getmessageList()},sendContent:function(){var e=this;console.log(Date.parse(new Date)/1e3);var t={receive_id:this.userID,content:this.messageContent,send_time:Date.parse(new Date)/1e3};this.HttpClient.post("/admin/private/message",t).then(function(t){200==t.data.code&&(e.$message.success(t.data.msg),e.messageContent="",setTimeout(function(){e.getmessageList()},500))})}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"userActivity"},[a("BreadCrumb",{staticClass:"bread",attrs:{breadData:e.breadData}}),e._v(" "),a("div",{staticClass:"userActivity_main"},[e._m(0),e._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_chart"}),e._v(" "),a("div",{staticClass:"content_header"},[a("div",{staticClass:"content_header_search"},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"昵称搜索"},model:{value:e.nickNameSearch,callback:function(t){e.nickNameSearch=t},expression:"nickNameSearch"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){e.initData(e.nickNameSearch)}},slot:"append"})],1),e._v(" "),a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"用户名搜索"},model:{value:e.userNameSearch,callback:function(t){e.userNameSearch=t},expression:"userNameSearch"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){e.initData("",e.userNameSearch)}},slot:"append"})],1)],1)]),e._v(" "),a("div",{staticClass:"content_table"},[a("el-table",{attrs:{data:e.tableData,border:!0}},[a("el-table-column",{attrs:{label:"ID",align:"center",width:"80",prop:"id",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"用户昵称",align:"center",width:"220","show-overflow-tooltip":"",prop:"nickname"}}),e._v(" "),a("el-table-column",{attrs:{label:"用户名",align:"center","show-overflow-tooltip":"",width:"220",prop:"username"}}),e._v(" "),a("el-table-column",{attrs:{label:"电话",align:"center","show-overflow-tooltip":"",width:"220",prop:"phone"}}),e._v(" "),a("el-table-column",{attrs:{label:"余额",align:"center","show-overflow-tooltip":"",width:"180",prop:"balance",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"平均登陆时间（天）",align:"center","show-overflow-tooltip":"",width:"200",prop:"average_login",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"电量",align:"center","show-overflow-tooltip":"",width:"220",prop:"electric",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"table_scope"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"scope_btm"},[a("el-button",{attrs:{size:"medium",type:"text"},on:{click:function(a){e.sendMessageFn(t.row)}}},[e._v("发私信")]),e._v(" "),a("el-button",{attrs:{size:"medium",type:"text"}},[e._v("查看用户页面")])],1)]}}])})],1),e._v(" "),a("el-pagination",{attrs:{layout:"prev, pager, next",total:e.total,"current-page":e.currentPage,"page-size":25},on:{"update:currentPage":function(t){e.currentPage=t},"current-change":e.handleCurrentChange}})],1)])]),e._v(" "),a("el-dialog",{attrs:{width:"400px","custom-class":"chatDialog",visible:e.chatDialog},on:{"update:visible":function(t){e.chatDialog=t}}},[a("span",{staticClass:"chatDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-message"}),e._v("发私信")]),e._v(" "),e._l(e.messageData,function(t,s){return a("div",{key:s,staticClass:"chat_dialog_box"},[t.receive_id!==e.userID?a("div",{staticClass:"chat_list chat_user"},[a("div",{staticClass:"chat_time"},[e._v(e._s(t.send_time))]),e._v(" "),a("div",{staticClass:"chat_message"},[e._v(e._s(t.content))])]):e._e(),e._v(" "),t.receive_id==e.userID?a("div",{staticClass:"chat_list chat_admin"},[a("div",{staticClass:"chat_time"},[e._v(e._s(t.send_time))]),e._v(" "),a("div",{staticClass:"chat_message"},[e._v(e._s(t.content))])]):e._e()])}),e._v(" "),a("div",{staticClass:"chat_input"},[a("el-input",{attrs:{placeholder:"输入私信内容",clearable:""},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.sendContent(t):null}},model:{value:e.messageContent,callback:function(t){e.messageContent=t},expression:"messageContent"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.sendContent}},[e._v("发送")])],1),e._v(" "),a("el-pagination",{attrs:{layout:"prev, pager, next",total:e.totalmessage,"current-page":e.currentmessagePage,"page-size":10},on:{"update:currentPage":function(t){e.currentmessagePage=t},"current-change":e.handleCurrentmessageChange}})],2)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title"},[t("p",[this._v("用户活跃度")])])}]};var i=a("VU/8")(s,n,!1,function(e){a("krSu")},null,null);t.default=i.exports},krSu:function(e,t){}});