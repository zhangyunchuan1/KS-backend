webpackJsonp([46],{"U/k3":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={name:"NewInformation",components:{BreadCrumb:a("ZPfm").a},data:function(){return{breadData:[{id:1,name:"商城",urls:"/index/mall/Mall",icon:"icon-home"},{id:2,name:"客服",urls:"/index/mall/service/Service",icon:"icon-home"},{id:3,name:"新消息",urls:"/index/mall/service/NewInformation",icon:"icon-home"}],tableData:[],managerID:"",charContent:"",listID:"",chatDialog:!1,innerVisible:!1,userName:null,total:null,pageSize:25,currentPage:1,chatpageSize:5,chatCurrentpage:1,chatTotal:0,textarea:"",MessageList:[{name:"飞机",type:1,contant:"slkd就是改第一师范；联发科ghg浪费你好浪费更过来看你",time:"2018-11-25"},{name:"伐木工",type:0,contant:"slkdghg浪费你好浪是否郭德纲费更过来看你",time:"2018-11-25"},{name:"非官方个",type:1,contant:"slkdghg浪费你好鼎折覆餗浪费更过来看你",time:"2018-11-25"},{name:"飞刚发的机",type:0,contant:"slkdghg浪费第三个是的发生的你好浪费更过来看你",time:"2018-11-25"}]}},mounted:function(){this.getMessageList()},methods:{handleOpenTalk:function(t){console.log(t),this.chatDialog=!0,this.managerID=t.manager_id,this.listID=t.uid,this.getchatList()},getchatList:function(){var t=this,e={cs_id:localStorage.getItem("userid"),list_uid:this.listID,page_size:this.chatpageSize,page:this.chatCurrentpage};this.HttpClient.post("/admin/message/info",e).then(function(e){console.log(e.data),t.MessageList=e.data.data.data,t.chatTotal=e.data.data.total})},chatCurrentChange:function(t){this.chatCurrentpage=t,this.getchatList()},handleEndMessage:function(t){var e=this,a=t.manager_id;this.HttpClient.post("/admin/end/message",{manager_id:a}).then(function(t){var a=t.data,n=a.code,s=a.msg;200===n&&e.$message.success(s)})},dateFtt:function(){var t=new Date;function e(t){return t<10?"0"+t:t}return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())},handleReply:function(t){var e=this,a={manager_id:this.managerID,content:this.charContent,send_time:this.dateFtt()};console.log(a),this.HttpClient.post("/admin/receive/message",a).then(function(t){console.log(t.data),200===t.data.code&&(e.charContent="",setTimeout(function(){e.getchatList()},500))})},handleAddUserMessage:function(){},getHistoryTalk:function(){},getMessageList:function(){var t=this;this.HttpClient.post("/admin/customer/message",{page:this.currentPage,page_size:this.pageSize}).then(function(e){var a=e.data,n=a.code,s=a.data,i=s.total,l=s.data;200===n&&(t.tableData=l,t.total=i)})},handleCurrentChange:function(t){this.getMessageList(t)},tableRowClassName:function(t){var e=t.row;t.rowIndex;return 1===e.type?"success-row":3===e.type?"warning-row":""}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"newInformation"},[a("BreadCrumb",{staticClass:"bread",attrs:{breadData:t.breadData}}),t._v(" "),a("div",{staticClass:"newInformation_main"},[t._m(0),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_main"},[a("div",{staticClass:"content_table"},[a("el-table",{attrs:{data:t.tableData,border:!0,"row-class-name":t.tableRowClassName}},[a("el-table-column",{attrs:{label:"对话创建时间",align:"center",width:"200",prop:"created_at",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{label:"用户昵称",align:"center",width:"280",prop:"nickname"}}),t._v(" "),a("el-table-column",{attrs:{label:"用户类型",align:"center",width:"200",prop:"type"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.type?a("span",[t._v("用户")]):t._e(),t._v(" "),2===e.row.type?a("span",[t._v("商家")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"信息内容",align:"center",width:"650",prop:"content"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"mallReview_scope",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"mallReview_btm"},[a("el-button",{on:{click:function(a){t.handleOpenTalk(e.row)}}},[t._v("对话")]),t._v(" "),a("el-button",{on:{click:function(a){t.handleEndMessage(e.row)}}},[t._v("结束对话")])],1)]}}])})],1),t._v(" "),t.total?a("el-pagination",{attrs:{layout:"prev, pager, next",total:t.total,"page-size":25},on:{"current-change":function(e){t.handleCurrentChange(e)}}}):t._e()],1)])])]),t._v(" "),a("el-dialog",{attrs:{visible:t.chatDialog,width:"800px","custom-class":"chatDialog"},on:{"update:visible":function(e){t.chatDialog=e}}},[a("span",{staticClass:"chatDialog_title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"iconfont icon-mail"}),t._v("\n      对话- "+t._s(t.userName)+"\n    ")]),t._v(" "),a("div",{staticClass:"chatDialog_main"},[a("div",{staticClass:"main_content",attrs:{id:"neir"}},t._l(t.MessageList,function(e,n){return a("div",{key:n,staticClass:"neir"},[e.send_id==t.listID?a("div",{staticClass:"user_chat chat_list"},[a("div",{staticClass:"service_time"},[t._v(t._s(e.send_time))]),t._v(" "),a("p",{staticClass:"service_message"},[a("span",{staticClass:"service_serviceName"},[t._v(t._s(e.send_nickname))])]),t._v(" "),a("p",{staticClass:"user_content"},[t._v(t._s(e.content))])]):t._e(),t._v(" "),e.send_id!==t.listID?a("div",{staticClass:"service_chat chat_list"},[a("div",{staticClass:"service_time"},[t._v(t._s(e.send_time))]),t._v(" "),a("p",{staticClass:"service_message"},[a("span",{staticClass:"service_serviceName"},[t._v(t._s(e.send_nickname))])]),t._v(" "),a("p",{staticClass:"chat_content"},[t._v(t._s(e.content))])]):t._e()])})),t._v(" "),t.chatTotal?a("el-pagination",{attrs:{layout:"prev, pager, next",total:t.chatTotal,"page-size":this.chatpageSize},on:{"current-change":t.chatCurrentChange}}):t._e(),t._v(" "),a("div",{staticClass:"char_input"},[a("el-input",{attrs:{type:"textarea",resize:"none",placeholder:"输入回复内容，请文明用语",rows:2},model:{value:t.charContent,callback:function(e){t.charContent=e},expression:"charContent"}})],1)],1),t._v(" "),a("el-dialog",{attrs:{width:"300px",visible:t.innerVisible,"append-to-body":""},on:{"update:visible":function(e){t.innerVisible=e}}},[a("div",{staticClass:"inner_box"},[a("i",{staticClass:"iconfont icon-warning-circle"}),t._v(" "),a("div",[t._v("此对话已不存在！")])]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.innerVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"}},[t._v("确 定")])],1)]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.chatDialog=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.handleReply("a-component")}}},[t._v("回 复")])],1)],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("p",[this._v("新消息")]),this._v(" "),e("p",{staticStyle:{cursor:"pointer"}},[e("i",{staticClass:"iconfont icon-shuaxin"}),this._v("\n        刷新\n      ")])])}]};var i=a("VU/8")(n,s,!1,function(t){a("eknz")},null,null);e.default=i.exports},eknz:function(t,e){}});