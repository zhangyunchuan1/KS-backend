webpackJsonp([157],{"+9/n":function(t,e){},"eN+h":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("+jNi"),o=(i("7+uW"),{name:"ProductModify",components:{DeleteModal:a.a},data:function(){return{dialogImageUrl:"",dialogVisible:!1,videoUrl:"",videoDialogVisible:!1,modifyVisible:!1,brandRadio:2,checkList:["方形","三角形"],voltage:"50",length:"0.5",rotatingSpeed:"0.5",editorOption:{modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"]]}},productInfo:{},updateInfo:{id:this.$route.query.id,title:"",video:"",asin:"",description:"",content:"",show_picture:[],attachment:[]},goodsId:"",tags:[],tagId:"",newTagName:""}},methods:{handleRemove:function(t,e){var i=this;console.log(t,e),this.updateInfo.show_picture.map(function(e,a){e.url===t.url&&i.updateInfo.show_picture.splice(a,1)})},imageUpload:function(t){var e=this;this.HttpClient.form("/admin/uploadOneImage",{images:t}).then(function(i){200===i.data.code&&(e.$message.success(i.data.msg),e.updateInfo.show_picture.push({name:t.name,url:i.data.path}))})},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleAvatarSuccess:function(t,e){this.videoUrl=URL.createObjectURL(e.raw)},videoUpload:function(t){var e=this,i="video/mp4"===t.type;return i||this.$message.error("上传视频只能是 MP4 格式!"),this.HttpClient.form("/admin/uploadOneVideo",{video:t}).then(function(i){console.log(i),200===i.data.code?(e.$message.success(i.data.msg),e.videoUrl=i.data.path,e.updateInfo.video=[{name:t.name,path:i.data.path.substr(25)}]):e.$message.error(i.data.msg)}),i},listHandleRemove:function(t,e){var i=this;console.log(t,e),this.updateInfo.attachment.map(function(e,a){e.url===t.url&&i.updateInfo.attachment.splice(a,1)}),console.log(this.updateInfo.attachment)},listHandlePreview:function(t){console.log(t)},fileUpload:function(t){var e=this;this.HttpClient.form("/admin/uploadOneFile",{files:t}).then(function(i){200===i.data.code?(e.$message.success(i.data.msg),e.updateInfo.attachment.push({name:t.name,url:i.data.path}),console.log(e.updateInfo.attachment)):e.$message.error(i.data.msg)})},updateTag:function(t){this.tagId=t,this.modifyVisible=!0},deleteButton:function(t){this.tagId=t,this.$refs.delete.deleteDialog=!0},updateTagConfirm:function(){var t=this;this.HttpClient.post("/admin/tags/edit",{relation_id:this.updateInfo.asin,name:this.newTagName,tag_id:this.tagId}).then(function(e){200===e.data.code?(t.$message.success(e.data.msg),t.modifyVisible=!1,t.tags.map(function(e){e.tag_id===t.tagId&&(e.name=t.newTagName)})):t.$message.error(e.data.msg)})},deleteConfirm:function(){var t=this;this.HttpClient.post("/admin/tags/del",{tag_id:this.tagId,relation_id:this.updateInfo.asin}).then(function(e){200===e.data.code?(t.$message.success(e.data.msg),t.tags.map(function(e,i){e.tag_id===t.tagId&&t.tags.splice(i,1)})):t.$message.error(e.data.msg)})},getProductInfo:function(){var t=this;this.HttpClient.get("/admin/marketGoods/edit",{id:this.$route.query.id}).then(function(e){if(console.log(e),200===e.data.code){var i=e.data.data,a=i.title,o=i.video,s=i.asin,n=i.description,d=i.show_picture,l=i.attachment,c=i.tags;i.cate_property;t.productInfo=e.data.data,t.updateInfo.asin=s,t.updateInfo.title=a,t.updateInfo.video=o,t.updateInfo.description=n,t.updateInfo.content=e.data.data.content,d&&(t.updateInfo.show_picture=[],d.map(function(e){t.updateInfo.show_picture.push({name:e.name,url:t.Tools.handleImg(e.path)})})),l&&(t.updateInfo.attachment=[],l.map(function(e){t.updateInfo.attachment.push({name:e.name,url:t.Tools.handleImg(e.path)})})),t.tags=c,o&&(t.videoUrl=o[0].path),console.log(t.updateInfo.video)}})},updateProduct:function(){var t=this;console.log(this.updateInfo),this.HttpClient.post("/admin/marketGoods/edit",this.updateInfo).then(function(e){200===e.data.code?(t.$message.success(e.data.msg),setTimeout(function(){t.getProductInfo()},1e3)):t.$message.error(e.data.msg)})},onEditorBlur:function(){},onEditorFocus:function(){},onEditorChange:function(t){}},created:function(){this.getProductInfo()}}),s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"productModify"},[i("div",{staticClass:"productModify_main"},[t._m(0),t._v(" "),i("div",{staticClass:"productModify_content"},[i("div",{staticClass:"productModify_list"},[i("div",{staticClass:"list_title"},[t._v("商品名称")]),t._v(" "),i("el-input",{staticClass:"list_main",model:{value:t.updateInfo.title,callback:function(e){t.$set(t.updateInfo,"title",e)},expression:"updateInfo.title"}})],1),t._v(" "),i("div",{staticClass:"productModify_list"},[i("div",{staticClass:"list_title"},[t._v("标签")]),t._v(" "),t._l(t.tags,function(e){return i("div",{key:e.tag_id,staticClass:"list_tags"},[i("p",{on:{click:function(i){t.updateTag(e.tag_id)}}},[t._v(t._s(e.name))]),t._v(" "),i("span",{on:{click:function(i){t.deleteButton(e.tag_id)}}})])})],2),t._v(" "),i("div",{staticClass:"productModify_list"},[i("div",{staticClass:"list_title"},[t._v("商品简介")]),t._v(" "),i("el-input",{staticClass:"list_textarea",attrs:{type:"textarea",resize:"none"},model:{value:t.updateInfo.description,callback:function(e){t.$set(t.updateInfo,"description",e)},expression:"updateInfo.description"}})],1),t._v(" "),i("div",{staticClass:"productModify_list richText"},[i("div",{staticClass:"list_title"},[t._v("商品详情")]),t._v(" "),i("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{blur:function(e){t.onEditorBlur(e)},focus:function(e){t.onEditorFocus(e)},change:function(e){t.onEditorChange(e)}},model:{value:t.updateInfo.content,callback:function(e){t.$set(t.updateInfo,"content",e)},expression:"updateInfo.content"}})],1),t._v(" "),i("div",{staticClass:"productModify_list"},[i("div",{staticClass:"list_title"},[t._v("轮播图")]),t._v(" "),i("div",{staticClass:"list_uploadImg"},[i("el-upload",{attrs:{action:"/","list-type":"picture-card","before-upload":t.imageUpload,"on-preview":t.handlePictureCardPreview,"file-list":t.updateInfo.show_picture,"on-remove":t.handleRemove}},[i("i",{staticClass:"el-icon-plus"})]),t._v(" "),i("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)]),t._v(" "),i("div",{staticClass:"productModify_list"},[i("div",{staticClass:"list_title"},[t._v("视频")]),t._v(" "),i("div",{staticClass:"list_uploadVideo"},[i("el-upload",{staticClass:"video-uploader",attrs:{action:"/","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.videoUpload}},[t.videoUrl?i("video",{staticClass:"videoView",attrs:{controls:"",src:t.videoUrl}}):i("i",{staticClass:"el-icon-plus video-uploader-icon"})])],1)]),t._v(" "),i("div",{staticClass:"productModify_list"},[i("div",{staticClass:"list_title"},[t._v("附件")]),t._v(" "),i("div",{staticClass:"list_uploadList"},[i("el-upload",{staticClass:"upload-demo",attrs:{action:"/","before-upload":t.fileUpload,"on-preview":t.listHandlePreview,"on-remove":t.listHandleRemove,"file-list":t.updateInfo.attachment}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1)])]),t._v(" "),i("div",{staticClass:"cloneProductModify_box"},[i("el-button",{staticClass:"cloneProductModify",on:{click:function(e){t.$router.go(-1)}}},[t._v("关闭")]),t._v(" "),i("el-button",{staticClass:"cloneProductModify",attrs:{type:"primary"},on:{click:t.updateProduct}},[t._v("保存")])],1)]),t._v(" "),i("el-dialog",{attrs:{"custom-class":"modifyDialog",visible:t.modifyVisible,width:"400px"},on:{"update:visible":function(e){t.modifyVisible=e}}},[i("span",{staticClass:"modifyVisible_title",attrs:{slot:"title"},slot:"title"},[i("i",{staticClass:"iconfont icon-edit-square"}),t._v("修改")]),t._v(" "),i("div",{staticClass:"modifyVisible"},[i("p",[t._v("新标签名称：")]),t._v(" "),i("div",[i("el-input",{model:{value:t.newTagName,callback:function(e){t.newTagName=e},expression:"newTagName"}})],1)]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.modifyVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.updateTagConfirm}},[t._v("保 存")])],1)]),t._v(" "),i("delete-modal",{ref:"delete",on:{doDelete:t.deleteConfirm}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("p",[this._v("DJI MAVIC2-修改")])])}]};var n=i("VU/8")(o,s,!1,function(t){i("+9/n")},null,null);e.default=n.exports}});